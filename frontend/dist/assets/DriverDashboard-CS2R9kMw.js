import{u as M,r as w,c as _,o as O,a as r,b as e,g as T,e as v,i as d,w as c,h as x,R as u,t as o,F as g,f as b,j as k,k as a}from"./index-17v5VSGm.js";import{v as G}from"./jobs-rqOJ3JE0.js";const L={class:"space-y-6"},R={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},S={key:0,class:"rounded-2xl border bg-white p-4 text-sm text-slate-600"},Y={key:1,class:"rounded-2xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-700"},$={class:"grid grid-cols-3 gap-3 lg:grid-cols-4"},q={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},E={class:"mt-2 text-2xl font-bold text-slate-900"},I={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},U={class:"mt-2 text-2xl font-bold text-slate-900"},K={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},W={class:"mt-2 text-2xl font-bold text-slate-900"},z={class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm col-span-3 lg:col-span-1"},H={class:"mt-2 text-2xl font-bold text-slate-900"},Q={key:0,class:"rounded-2xl border border-emerald-100 bg-emerald-50 p-4 shadow-sm col-span-3 lg:col-span-1"},X={key:0,class:"rounded-2xl border border-slate-200 bg-white p-6 space-y-3"},Z={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},ee={class:"rounded-2xl border border-slate-200 bg-white p-6 space-y-4"},te={class:"flex items-center justify-between"},se={key:0,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},oe={key:1,class:"space-y-3"},le={class:"flex flex-wrap items-start justify-between gap-3"},ae={class:"text-sm font-semibold text-slate-900"},re={class:"text-xs text-slate-500"},de={class:"text-xs text-slate-500"},ne={class:"text-right"},ie={class:"text-lg font-bold text-emerald-600"},ce={class:"badge bg-emerald-100 text-emerald-700"},xe={class:"rounded-2xl border border-slate-200 bg-white p-6 space-y-4"},ue={class:"flex items-center justify-between"},pe={key:0,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},be={key:1,class:"space-y-3"},me={class:"flex flex-wrap items-start justify-between gap-3"},he={class:"text-sm font-semibold text-slate-900"},fe={class:"text-xs text-slate-500"},_e={class:"text-xs text-slate-500"},ve={class:"text-right"},ge={class:"text-lg font-bold text-emerald-600"},ye={class:"badge bg-amber-100 text-amber-700"},we={key:0,class:"mt-2 rounded-xl bg-slate-50 p-3 text-sm text-slate-600"},ke={class:"rounded-2xl border border-slate-200 bg-white p-6 space-y-4"},De={class:"flex items-center justify-between"},Pe={key:0,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},je={key:1,class:"space-y-3"},Ae={class:"flex flex-wrap items-start justify-between gap-3"},Be={class:"text-sm font-semibold text-slate-900"},Fe={class:"text-xs text-slate-500"},Ne={class:"text-right"},Je={class:"text-lg font-bold text-emerald-600"},Ve={class:"badge bg-slate-200 text-slate-800"},Ce={class:"text-xs text-slate-500"},Ge={__name:"DriverDashboard",setup(Me){const n=M(),i=w(null),y=w(!1),m=w(""),V=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0});function h(l){return V.format(Number(l||0))}function D(l){if(!l)return"--";try{return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(l))}catch{return l}}async function C(){y.value=!0,m.value="";try{i.value=await G()}catch(l){console.error("Failed to load driver overview",l),m.value="We could not load your dashboard. Please try again.",i.value=null}finally{y.value=!1}}const f=_(()=>{var l;return((l=i.value)==null?void 0:l.stats)??{}}),P=_(()=>{var l;return((l=i.value)==null?void 0:l.active)??[]}),j=_(()=>{var l;return((l=i.value)==null?void 0:l.completed)??[]}),A=_(()=>{var l;return((l=i.value)==null?void 0:l.applications)??[]});return O(async()=>{!n.user&&n.token&&await n.fetchMe().catch(()=>null),await C()}),(l,t)=>(a(),r("div",L,[e("header",R,[t[1]||(t[1]=e("div",{class:"space-y-1"},[e("h1",{class:"text-2xl font-bold text-slate-900"},"Driver dashboard"),e("p",{class:"text-sm text-slate-600"}," Track your active runs, check pending applications, and review completed deliveries. ")],-1)),d(n).hasPlannerAccess?(a(),T(d(u),{key:0,to:"/planner",class:"inline-flex items-center justify-center gap-2 rounded-xl border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm hover:bg-slate-50"},{default:c(()=>[...t[0]||(t[0]=[x(" Open planner ",-1),e("span",{"aria-hidden":"true"},"→",-1)])]),_:1})):v("",!0)]),y.value?(a(),r("div",S," Loading your driver workspace... ")):m.value?(a(),r("p",Y,o(m.value),1)):(a(),r(g,{key:2},[e("section",$,[e("article",q,[t[2]||(t[2]=e("h2",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Active jobs",-1)),e("p",E,o(f.value.active_count??0),1)]),e("article",I,[t[3]||(t[3]=e("h2",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Completed jobs",-1)),e("p",U,o(f.value.completed_count??0),1)]),e("article",K,[t[4]||(t[4]=e("h2",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Pending applications",-1)),e("p",W,o(f.value.pending_applications??0),1)]),e("article",z,[t[5]||(t[5]=e("h2",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Total earnings",-1)),e("p",H,o(h(f.value.total_earnings??0)),1)]),d(n).hasPlannerAccess?(a(),r("article",Q,[t[7]||(t[7]=e("h2",{class:"text-xs font-semibold uppercase tracking-wide text-emerald-700"},"Planner status",-1)),t[8]||(t[8]=e("p",{class:"mt-2 text-base font-semibold text-emerald-900"}," Keep your availability synced with upcoming runs. ",-1)),b(d(u),{to:"/planner",class:"mt-3 inline-flex items-center gap-2 rounded-xl border border-emerald-200 bg-white px-3 py-1 text-xs font-semibold text-emerald-700 hover:bg-emerald-100/60"},{default:c(()=>[...t[6]||(t[6]=[x(" Manage schedule ",-1),e("span",{"aria-hidden":"true"},"→",-1)])]),_:1})])):v("",!0)]),d(n).hasPlannerAccess?(a(),r("section",X,[e("div",Z,[t[10]||(t[10]=e("div",null,[e("h2",{class:"text-lg font-semibold text-slate-900"},"Planner quick access"),e("p",{class:"text-xs text-slate-500"}," Block out your calendar, pin pick-ups, and hold delivery slots before accepting new work. ")],-1)),b(d(u),{to:"/planner",class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50"},{default:c(()=>[...t[9]||(t[9]=[x(" Open planner ",-1),e("span",{"aria-hidden":"true"},"→",-1)])]),_:1})]),t[11]||(t[11]=e("p",{class:"text-xs text-slate-500"}," Saved routes and holds appear in the planner view. Update it daily to keep dealers in sync with your availability. ",-1))])):v("",!0),e("section",ee,[e("div",te,[t[13]||(t[13]=e("div",null,[e("h2",{class:"text-lg font-semibold text-slate-900"},"Active jobs"),e("p",{class:"text-xs text-slate-500"}," Jobs currently assigned to you. Update status from the job detail screen. ")],-1)),b(d(u),{to:"/jobs",class:"text-xs font-semibold text-emerald-600 hover:underline"},{default:c(()=>[...t[12]||(t[12]=[x(" View jobs -> ",-1)])]),_:1})]),P.value.length?(a(),r("div",oe,[(a(!0),r(g,null,k(P.value,s=>{var p;return a(),r("article",{key:s.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[e("div",le,[e("div",null,[e("p",ae,o(s.title||`Job #${s.id}`),1),e("p",re,o(s.pickup_postcode||"--")+" -> "+o(s.dropoff_postcode||"--"),1),e("p",de," Posted by "+o(((p=s.posted_by)==null?void 0:p.name)||"Dealer"),1)]),e("div",ne,[e("div",ie,o(h(s.price)),1),e("span",ce,o(s.status),1)])])])}),128))])):(a(),r("div",se," You have no active jobs right now. "))]),e("section",xe,[e("div",ue,[t[15]||(t[15]=e("div",null,[e("h2",{class:"text-lg font-semibold text-slate-900"},"Pending applications"),e("p",{class:"text-xs text-slate-500"}," Dealers will review and confirm your application. You will be notified once accepted. ")],-1)),b(d(u),{to:"/jobs",class:"text-xs font-semibold text-emerald-600 hover:underline"},{default:c(()=>[...t[14]||(t[14]=[x(" Browse jobs -> ",-1)])]),_:1})]),A.value.length?(a(),r("div",be,[(a(!0),r(g,null,k(A.value,s=>{var p,B,F,N,J;return a(),r("article",{key:s.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[e("div",me,[e("div",null,[e("p",he,o(((p=s.job)==null?void 0:p.title)||`Job #${(B=s.job)==null?void 0:B.id}`),1),e("p",fe," Dealer: "+o(((N=(F=s.job)==null?void 0:F.posted_by)==null?void 0:N.name)||"Dealer"),1),e("p",_e," Applied "+o(D(s.created_at)),1)]),e("div",ve,[e("div",ge,o(h((J=s.job)==null?void 0:J.price)),1),e("span",ye,o(s.status),1)])]),s.message?(a(),r("p",we,' "'+o(s.message)+'" ',1)):v("",!0)])}),128))])):(a(),r("div",pe," You have no pending applications. "))]),e("section",ke,[e("div",De,[t[17]||(t[17]=e("div",null,[e("h2",{class:"text-lg font-semibold text-slate-900"},"Recently completed"),e("p",{class:"text-xs text-slate-500"}," A quick snapshot of the latest closed jobs. Explore everything from your scorecard. ")],-1)),b(d(u),{to:"/profile",class:"text-xs font-semibold text-emerald-600 hover:underline"},{default:c(()=>[...t[16]||(t[16]=[x(" View scorecard -> ",-1)])]),_:1})]),j.value.length?(a(),r("div",je,[(a(!0),r(g,null,k(j.value.slice(0,5),s=>(a(),r("article",{key:s.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[e("div",Ae,[e("div",null,[e("p",Be,o(s.title||`Job #${s.id}`),1),e("p",Fe,o(s.pickup_postcode||"--")+" -> "+o(s.dropoff_postcode||"--"),1)]),e("div",Ne,[e("div",Je,o(h(s.price)),1),e("span",Ve,o(s.status),1)])]),e("p",Ce," Completed "+o(D(s.updated_at??s.created_at)),1)]))),128))])):(a(),r("div",Pe," No completed jobs yet. "))])],64))]))}};export{Ge as default};
