import{u as f,r as u,o as h,l as g,c as b,a as l,e as y,w,h as k,i as m,R as j,t as a,b as e,y as D,k as i}from"./index-CbeUM-tk.js";import{b as N}from"./jobs-BugcPTwM.js";const T={class:"space-y-4"},B={key:0,class:"rounded-2xl border bg-white p-4 text-sm text-slate-600"},J={key:1,class:"rounded-2xl border bg-white p-4 text-sm text-amber-600"},V={key:2,class:"rounded-2xl border bg-white p-4 text-sm text-slate-600"},$={key:3,class:"space-y-4"},F={class:"flex flex-col items-start justify-between gap-3 rounded-2xl border bg-white p-6 md:flex-row md:items-center"},S={class:"text-2xl font-bold text-slate-900"},C={class:"text-sm text-slate-600"},L={class:"text-right"},M={class:"text-3xl font-extrabold text-emerald-600"},P={class:"badge bg-slate-100 text-slate-800"},R={class:"grid gap-4 lg:grid-cols-3"},A={class:"tile p-4"},G={class:"text-lg font-bold text-slate-900"},I={class:"text-sm text-slate-600"},E={class:"mt-3 text-sm text-slate-500"},W={class:"tile p-4"},q={class:"text-lg font-bold text-slate-900"},z={class:"text-sm text-slate-600"},H={class:"mt-3 text-sm text-slate-500"},K={class:"tile p-4 space-y-2"},O={class:"flex items-center justify-between"},Q={class:"text-base font-semibold text-slate-900"},U={class:"flex items-center justify-between"},X={class:"text-base font-semibold text-slate-900"},Y={class:"flex items-center justify-between"},Z={class:"text-base font-semibold text-slate-900"},ee={class:"tile p-4"},te={class:"mt-2 text-sm text-slate-600"},se={class:"mt-4 space-y-2"},ae={id:"job-driver-select",class:"w-full rounded-xl border border-slate-200 bg-slate-50 px-3 py-2 text-sm font-semibold text-slate-700",disabled:""},oe=["value"],le={key:1,value:"unassigned"},ce={__name:"JobDetail",setup(ie){const p=D(),c=f(),t=u(null),r=u(!1),d=u(""),x=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0});async function v(){const n=p.params.id;if(n){r.value=!0,d.value="";try{const s=await N(n);t.value=(s==null?void 0:s.data)??s??null}catch(s){console.error("Failed to load job",s),d.value="We could not load this job.",t.value=null}finally{r.value=!1}}}h(async()=>{!c.user&&c.token&&await c.fetchMe().catch(()=>null),await v()}),g(()=>p.params.id,()=>{v()});const o=b(()=>{var n;return((n=t.value)==null?void 0:n.assigned_to)??null}),_=b(()=>t.value?t.value.status==="open"?"This job is open and awaiting acceptance by a driver.":t.value.status==="accepted"||t.value.status==="collected"||t.value.status==="in_transit"?o.value?`This job has been accepted by ${o.value.name}.`:"This job has been accepted by a driver.":t.value.status==="delivered"||t.value.status==="completed"?o.value?`This job was completed by ${o.value.name}.`:"This job has been completed.":t.value.status==="cancelled"?"This job has been cancelled.":`This job status is ${t.value.status}.`:"");return(n,s)=>(i(),l("div",T,[y(m(j),{to:"/jobs",class:"text-sm font-semibold text-emerald-600 hover:underline"},{default:w(()=>[...s[0]||(s[0]=[k(" ← Back to jobs ",-1)])]),_:1}),r.value?(i(),l("div",B," Loading job… ")):d.value?(i(),l("div",J,a(d.value),1)):t.value?(i(),l("div",$,[e("header",F,[e("div",null,[e("h1",S,a(t.value.title||`Job #${t.value.id}`),1),e("p",C,a(t.value.company||"Customer")+" · "+a(t.value.vehicle_make||"Vehicle"),1)]),e("div",L,[e("div",M,a(m(x).format(Number(t.value.price??0))),1),e("div",P,a(t.value.status),1)])]),e("section",R,[e("div",A,[s[1]||(s[1]=e("h2",{class:"text-sm font-semibold uppercase tracking-wide text-slate-500"},"Pickup",-1)),e("p",G,a(t.value.pickup_label||"Pickup location"),1),e("p",I,a(t.value.pickup_postcode||"—"),1),e("p",E,a(t.value.pickup_notes||"No pickup notes provided."),1)]),e("div",W,[s[2]||(s[2]=e("h2",{class:"text-sm font-semibold uppercase tracking-wide text-slate-500"},"Drop-off",-1)),e("p",q,a(t.value.dropoff_label||"Drop-off location"),1),e("p",z,a(t.value.dropoff_postcode||"—"),1),e("p",H,a(t.value.dropoff_notes||"No delivery notes provided."),1)]),e("div",K,[e("div",O,[s[3]||(s[3]=e("span",{class:"text-sm font-semibold text-slate-500"},"Distance",-1)),e("span",Q,a(t.value.distance_mi?`${t.value.distance_mi} mi`:"—"),1)]),e("div",U,[s[4]||(s[4]=e("span",{class:"text-sm font-semibold text-slate-500"},"Vehicle type",-1)),e("span",X,a(t.value.vehicle_type||"—"),1)]),e("div",Y,[s[5]||(s[5]=e("span",{class:"text-sm font-semibold text-slate-500"},"Created",-1)),e("span",Z,a(t.value.created_at?new Date(t.value.created_at).toLocaleString():"—"),1)])])]),e("section",ee,[s[7]||(s[7]=e("h2",{class:"text-sm font-semibold uppercase tracking-wide text-slate-500"},"Status",-1)),e("p",te,a(_.value),1),e("div",se,[s[6]||(s[6]=e("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500",for:"job-driver-select"}," Assigned driver ",-1)),e("select",ae,[o.value?(i(),l("option",{key:0,value:o.value.id},a(o.value.name)+" ("+a(o.value.email)+") ",9,oe)):(i(),l("option",le," No driver assigned "))])])])])):(i(),l("div",V," Job not found. "))]))}};export{ce as default};
