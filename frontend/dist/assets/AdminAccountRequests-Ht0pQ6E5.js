import{a as R,d as D}from"./account-CYXTeYHc.js";import{r as m,G as v,c as f,o as F,s as S,a as o,b as e,e as h,F as y,j as w,n as k,t as d,k as r}from"./index-17v5VSGm.js";const B={class:"space-y-6"},L={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},M={class:"mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},N={class:"flex gap-2 text-xs font-semibold"},P=["onClick"],U={key:0,class:"mb-6 rounded-2xl border border-amber-100 bg-amber-50 p-4 text-xs text-amber-700"},$={class:"font-semibold text-amber-900"},E={key:1,class:"rounded-2xl border border-amber-100 bg-amber-50 p-4 text-sm text-amber-700"},V={key:2,class:"rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},z={key:3,class:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},G={key:4,class:"space-y-3"},H={class:"flex flex-wrap items-center justify-between gap-3"},J={class:"text-sm font-semibold text-slate-900"},K={class:"text-xs text-slate-500"},O={class:"mt-3 grid gap-2 text-xs text-slate-600 md:grid-cols-2"},Q={class:"font-semibold text-slate-900"},T={class:"font-semibold text-slate-900"},W={class:"md:col-span-2"},X={class:"rounded-xl bg-slate-50 p-3 text-slate-700"},Y={class:"whitespace-pre-wrap text-xs"},Z={key:0,class:"md:col-span-2"},I={class:"rounded-xl bg-emerald-50 p-2 text-emerald-700"},q={key:0,class:"mt-4 flex flex-wrap gap-2"},ee=["onClick"],te=["onClick"],de={__name:"AdminAccountRequests",setup(se){const n=m("pending"),u=m([]),x=m(!1),p=m(""),A=v("adminDashboard",f(()=>({}))),C=v("refreshAdminDashboard",async()=>{});async function b(){var l,s,t;x.value=!0,p.value="";try{const a=await R({status:n.value});u.value=Array.isArray(a==null?void 0:a.data)?a.data:((l=a==null?void 0:a.data)==null?void 0:l.data)??[]}catch(a){console.error("Failed to load account requests",a),p.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Unable to load account change requests.",u.value=[]}finally{x.value=!1}}async function _(l,s){var a,i;if(!l)return;const t=s==="rejected"?window.prompt("Add a note for the customer (optional)","")??null:null;try{await D(l,{decision:s,admin_notes:t}),await Promise.all([b(),C()])}catch(c){console.error("Failed to update request",c),window.alert(((i=(a=c.response)==null?void 0:a.data)==null?void 0:i.message)||"Unable to update this request.")}}const g=f(()=>{var l,s;return((s=(l=A.value)==null?void 0:l.account_updates)==null?void 0:s.pending)??[]});return F(b),S(n,b),(l,s)=>(r(),o("div",B,[e("section",L,[e("header",M,[s[0]||(s[0]=e("div",null,[e("h1",{class:"text-xl font-semibold text-slate-900"},"Account update requests"),e("p",{class:"text-xs text-slate-500"}," Review profile changes submitted by dealers and drivers. Approvals immediately update their account. ")],-1)),e("div",N,[(r(),o(y,null,w(["pending","approved","rejected"],t=>e("button",{key:t,type:"button",class:k(["rounded-full px-4 py-1 transition",n.value===t?"bg-emerald-500 text-white shadow":"border border-emerald-200 text-emerald-700 hover:bg-emerald-50"]),onClick:a=>n.value=t},d(t.charAt(0).toUpperCase()+t.slice(1)),11,P)),64))])]),g.value.length?(r(),o("div",U,[e("p",$,"Pending requests: "+d(g.value.length),1),s[1]||(s[1]=e("p",{class:"mt-1"},"Review these soon to keep account data accurate.",-1))])):h("",!0),p.value?(r(),o("div",E,d(p.value),1)):x.value?(r(),o("div",V," Loading requests... ")):u.value.length?(r(),o("div",G,[(r(!0),o(y,null,w(u.value,t=>{var a,i,c;return r(),o("article",{key:t.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[e("header",H,[e("div",null,[e("p",J,d(((a=t.user)==null?void 0:a.name)||"MotorRelay user"),1),e("p",K," Submitted "+d(t.created_at?new Date(t.created_at).toLocaleString():"--"),1)]),e("span",{class:k(["rounded-full px-3 py-1 text-xs font-semibold",{"bg-emerald-100 text-emerald-700":t.status==="approved","bg-amber-100 text-amber-700":t.status==="pending","bg-rose-100 text-rose-700":t.status==="rejected"}])},d(t.status),3)]),e("dl",O,[e("div",null,[s[2]||(s[2]=e("dt",{class:"uppercase tracking-wide text-slate-500"},"Email",-1)),e("dd",Q,d(((i=t.user)==null?void 0:i.email)||"—"),1)]),e("div",null,[s[3]||(s[3]=e("dt",{class:"uppercase tracking-wide text-slate-500"},"Phone",-1)),e("dd",T,d(((c=t.user)==null?void 0:c.phone)||"—"),1)]),e("div",W,[s[4]||(s[4]=e("dt",{class:"uppercase tracking-wide text-slate-500"},"Change payload",-1)),e("dd",X,[e("pre",Y,d(t.payload),1)])]),t.admin_notes?(r(),o("div",Z,[s[5]||(s[5]=e("dt",{class:"uppercase tracking-wide text-slate-500"},"Admin notes",-1)),e("dd",I,d(t.admin_notes),1)])):h("",!0)]),t.status==="pending"?(r(),o("footer",q,[e("button",{type:"button",class:"rounded-xl bg-emerald-600 px-3 py-2 text-xs font-semibold text-white hover:bg-emerald-700",onClick:j=>_(t.id,"approved")}," Approve & apply ",8,ee),e("button",{type:"button",class:"rounded-xl border border-rose-200 px-3 py-2 text-xs font-semibold text-rose-600 hover:bg-rose-50",onClick:j=>_(t.id,"rejected")}," Reject ",8,te)])):h("",!0)])}),128))])):(r(),o("div",z," No "+d(n.value)+" requests right now. ",1))])]))}};export{de as default};
