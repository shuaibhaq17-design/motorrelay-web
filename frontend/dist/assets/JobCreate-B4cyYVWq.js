import{u as G,l as X,r as j,c,s as M,o as K,a as n,b as s,t as u,m as Q,e as g,h as A,p,v as b,F as Z,j as ee,n as te,x as J,y as T,q as se,k as i}from"./index-17v5VSGm.js";const oe={class:"mx-auto max-w-2xl space-y-6 rounded-2xl border bg-white p-6"},re={class:"text-2xl font-bold text-slate-900"},le={class:"text-sm text-slate-600"},ae={key:0,class:"rounded-xl border bg-slate-50 p-4 text-sm text-slate-600"},ne={key:1,class:"rounded-xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-700"},ie={key:0,class:"rounded-2xl border border-emerald-200 bg-emerald-50/70 p-4 text-sm text-emerald-800"},de={class:"mt-1"},ue={key:0},pe={key:0},me={key:0,class:"text-xs text-emerald-700"},ce={class:"mt-2 flex gap-2"},be=["onClick"],fe={class:"mt-2 text-xs text-slate-500"},ge={class:"rounded-2xl border border-slate-200 bg-slate-50 p-4"},ve={class:"grid gap-4 md:grid-cols-2"},xe={class:"rounded-2xl border border-emerald-200 bg-emerald-50/60 p-4"},_e={class:"flex items-start gap-3"},ye=["disabled"],he={class:"text-xs text-emerald-700"},ke={key:0,class:"mt-3 rounded-xl border border-amber-300 bg-amber-50 p-3 text-xs text-amber-800"},we={class:"mt-2 flex items-start gap-2"},je={key:1,class:"mt-3 text-xs text-amber-700"},Ue={key:1,class:"text-sm text-red-600"},Se={class:"flex justify-end"},Me=["disabled"],Te={key:0},Ce={key:1},De={__name:"JobCreate",props:{id:{type:[String,Number],default:null}},setup(I){const y=I,C=se(),d=G(),$={title:"",pickup_postcode:"",dropoff_postcode:"",vehicle_make:"",price:"",transport_type:"drive_away",pickup_date:"",pickup_time:"",delivery_date:"",delivery_time:"",is_urgent:!1,urgent_fee_ack:!1},o=X({...$}),h=j(!1),v=j(""),U=j(!1),k=j(""),S=[{value:"drive_away",label:"Drive-away",helper:"Driver delivers by driving the vehicle to the destination."},{value:"trailer",label:"Trailer",helper:"Vehicle transported on a trailer or transporter."}],O=c(()=>S.find(r=>r.value===o.transport_type)??S[0]),_=c(()=>y.id===null||y.id===void 0||y.id===""?null:String(y.id)),x=c(()=>!!_.value),Y=["gold_driver","dealer_pro"],D=c(()=>{var r;return(d.planSlug||((r=d.user)==null?void 0:r.plan_slug)||"").toLowerCase()}),L=c(()=>Y.includes(D.value)),w=c(()=>o.is_urgent&&!L.value),H=c(()=>o.is_urgent?L.value?"Urgent boost is included with your subscription.":"Urgent boost adds an extra charge on Starter so we can prioritise your job.":"Enable urgent boost to highlight your job to available drivers.");function W(r){o.transport_type=r}M(()=>o.is_urgent,r=>{r||(o.urgent_fee_ack=!1)});const a=c(()=>{var m,f,F,R;if(D.value!=="starter")return null;const r=((m=d.planLimits)==null?void 0:m.monthly_job_posts)??null,e=((f=d.usage)==null?void 0:f.job_posts_this_month)??0,t=((F=d.planLimits)==null?void 0:F.urgent_boost_per_month)??null,l=((R=d.usage)==null?void 0:R.urgent_boosts_used)??0;return{jobLimit:r,jobUsed:e,jobRemaining:r!=null?Math.max(r-e,0):null,urgentLimit:t,urgentUsed:l,urgentRemaining:t!=null?Math.max(t-l,0):null}}),P=c(()=>!a.value||a.value.urgentRemaining===null?!0:a.value.urgentRemaining>0);M(P,r=>{r||(o.is_urgent=!1,o.urgent_fee_ack=!1)});function V(r,e){if(!r)return null;const t=e?`${e}`:"00:00";return`${r} ${t}`}function B(r,e){if(!r)return null;const t=e?`${e}:00`:"00:00:00";return new Date(`${r}T${t}`)}async function z(){var r,e;if(!d.token){v.value="You need to log in as a dealer to create jobs.";return}if(x.value&&d.role!=="dealer"){v.value="Only dealers can edit jobs.";return}h.value=!0,v.value="";try{if(w.value&&!o.urgent_fee_ack)throw new Error("Please acknowledge the urgent boost fee before continuing.");const t=B(o.pickup_date,o.pickup_time),l=B(o.delivery_date,o.delivery_time);if(t&&l&&l<t)throw new Error("Delivery due time must be after the pickup ready time.");const m={title:o.title,pickup_postcode:o.pickup_postcode,dropoff_postcode:o.dropoff_postcode,vehicle_make:o.vehicle_make,price:Number(o.price||0),transport_type:o.transport_type,pickup_ready_at:V(o.pickup_date,o.pickup_time),delivery_due_at:V(o.delivery_date,o.delivery_time),is_urgent:o.is_urgent,urgent_accept_fee:w.value?o.urgent_fee_ack:!1};x.value?(await T.patch(`/jobs/${_.value}`,m),await d.fetchMe().catch(()=>null),C.push({name:"job-detail",params:{id:_.value}})):(await T.post("/jobs",m),await d.fetchMe().catch(()=>null),C.push({name:"jobs"}))}catch(t){console.error("Failed to create job",t),v.value=((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||t.message||"Could not save job. Please check the form."}finally{h.value=!1}}function E(){Object.assign(o,{...$})}function N(r){if(!r)return{date:"",time:""};const e=new Date(r);if(Number.isNaN(e.getTime()))return{date:"",time:""};const t=f=>String(f).padStart(2,"0"),l=`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())}`,m=`${t(e.getHours())}:${t(e.getMinutes())}`;return{date:l,time:m}}async function q(){var r,e;if(!x.value){E();return}U.value=!0,k.value="";try{const{data:t}=await T.get(`/jobs/${_.value}`),l=(t==null?void 0:t.data)??t??null;if(!l)throw new Error("Job not found.");const m=N(l.pickup_ready_at),f=N(l.delivery_due_at);Object.assign(o,{title:l.title||"",pickup_postcode:l.pickup_postcode||"",dropoff_postcode:l.dropoff_postcode||"",vehicle_make:l.vehicle_make||"",price:l.price!=null?String(l.price):"",transport_type:l.transport_type||"drive_away",pickup_date:m.date,pickup_time:m.time,delivery_date:f.date,delivery_time:f.time,is_urgent:!!l.is_urgent,urgent_fee_ack:!!l.is_urgent})}catch(t){console.error("Failed to load job for editing",t),k.value=((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||t.message||"We could not load this job for editing."}finally{U.value=!1}}return K(()=>{!d.user&&d.token&&d.fetchMe().catch(()=>null),x.value&&q()}),M(()=>_.value,(r,e)=>{r!==e&&(r?q():E())}),(r,e)=>(i(),n("div",oe,[s("header",null,[s("h1",re,u(x.value?"Edit Job":"Create Job"),1),s("p",le,u(x.value?"Update pickup, drop-off, vehicle details, price, and transport type.":"Include pick-up, drop-off, vehicle details, price, and transport type."),1)]),U.value?(i(),n("div",ae," Loading job details... ")):k.value?(i(),n("p",ne,u(k.value),1)):(i(),n("form",{key:2,class:"space-y-4",onSubmit:Q(z,["prevent"])},[a.value?(i(),n("div",ie,[e[11]||(e[11]=s("p",{class:"font-semibold text-emerald-900"},"Starter plan usage",-1)),s("p",de,[A("Job posts this month: "+u(a.value.jobUsed),1),a.value.jobLimit?(i(),n("span",ue," / "+u(a.value.jobLimit),1)):g("",!0)]),s("p",null,[A("Urgent boosts used: "+u(a.value.urgentUsed),1),a.value.urgentLimit?(i(),n("span",pe," / "+u(a.value.urgentLimit),1)):g("",!0)]),a.value.jobRemaining!==null?(i(),n("p",me,u(a.value.jobRemaining)+" job(s) remaining this month.",1)):g("",!0)])):g("",!0),s("div",null,[e[12]||(e[12]=s("label",{class:"text-sm font-semibold text-slate-700"},"Title",-1)),p(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.title=t),type:"text",required:"",placeholder:"e.g. Deliver Audi A3 to Manchester",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.title]])]),s("div",null,[e[13]||(e[13]=s("label",{class:"text-sm font-semibold text-slate-700"},"Pickup postcode",-1)),p(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.pickup_postcode=t),type:"text",required:"",placeholder:"e.g. M1 2AB",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.pickup_postcode]])]),s("div",null,[e[14]||(e[14]=s("label",{class:"text-sm font-semibold text-slate-700"},"Drop-off postcode",-1)),p(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.dropoff_postcode=t),type:"text",required:"",placeholder:"e.g. LS1 4XY",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.dropoff_postcode]])]),s("div",null,[e[15]||(e[15]=s("label",{class:"text-sm font-semibold text-slate-700"},"Vehicle make/model",-1)),p(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.vehicle_make=t),type:"text",placeholder:"e.g. BMW 3 Series",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.vehicle_make]])]),s("div",null,[e[16]||(e[16]=s("label",{class:"text-sm font-semibold text-slate-700"},"Price (GBP)",-1)),p(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.price=t),type:"number",min:"0",required:"",placeholder:"e.g. 120",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.price]])]),s("div",null,[e[17]||(e[17]=s("label",{class:"text-sm font-semibold text-slate-700"},"Transport type",-1)),s("div",ce,[(i(),n(Z,null,ee(S,t=>s("button",{key:t.value,type:"button",class:te(["rounded-xl border px-3 py-2 text-sm font-semibold transition",o.transport_type===t.value?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-slate-200 text-slate-600 hover:border-emerald-300 hover:text-emerald-700"]),onClick:l=>W(t.value)},u(t.label),11,be)),64))]),s("p",fe,u(O.value.helper),1)]),s("section",ge,[e[20]||(e[20]=s("header",{class:"mb-3"},[s("h2",{class:"text-sm font-semibold text-slate-700 uppercase tracking-wide"},"Timing preferences"),s("p",{class:"text-xs text-slate-500"}," Let drivers know when the vehicle is ready for collection and when you need it delivered. ")],-1)),s("div",ve,[s("div",null,[e[18]||(e[18]=s("label",{class:"text-xs font-semibold uppercase text-slate-500"},"Pickup ready date",-1)),p(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.pickup_date=t),type:"date",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.pickup_date]]),p(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.pickup_time=t),type:"time",class:"mt-2 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.pickup_time]])]),s("div",null,[e[19]||(e[19]=s("label",{class:"text-xs font-semibold uppercase text-slate-500"},"Delivery due by",-1)),p(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.delivery_date=t),type:"date",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.delivery_date]]),p(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>o.delivery_time=t),type:"time",class:"mt-2 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[b,o.delivery_time]])])])]),s("section",xe,[s("label",_e,[p(s("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>o.is_urgent=t),disabled:!P.value,type:"checkbox",class:"mt-1 h-4 w-4 rounded border-emerald-300 text-emerald-600 focus:ring-emerald-500"},null,8,ye),[[J,o.is_urgent]]),s("span",null,[e[21]||(e[21]=s("span",{class:"text-sm font-semibold text-emerald-800"},"Add urgent job boost",-1)),s("p",he,u(H.value),1)])]),w.value?(i(),n("div",ke,[e[23]||(e[23]=s("p",null,"The urgent boost adds an extra charge for Starter plans.",-1)),s("label",we,[p(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>o.urgent_fee_ack=t),type:"checkbox",class:"mt-0.5 h-4 w-4 rounded border-amber-300 text-amber-700 focus:ring-amber-500"},null,512),[[J,o.urgent_fee_ack]]),e[22]||(e[22]=s("span",null,"I understand an extra urgent fee will be added to this job.",-1))])])):g("",!0),a.value&&a.value.urgentRemaining===0?(i(),n("p",je," Starter urgent boost quota reached for this month. ")):g("",!0)]),e[24]||(e[24]=s("p",{class:"text-xs text-slate-500"}," New jobs stay private for the first three minutes so you can make quick corrections before drivers see them. ",-1)),v.value?(i(),n("p",Ue,u(v.value),1)):g("",!0),s("div",Se,[s("button",{type:"submit",class:"rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:h.value||w.value&&!o.urgent_fee_ack},[h.value?(i(),n("span",Te,"Creating...")):(i(),n("span",Ce,"Create job"))],8,Me)])],32))]))}};export{De as default};
