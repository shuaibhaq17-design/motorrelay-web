import{u as y,o as b,c as w,a as n,b as s,f as a,_ as v,w as c,h as p,C as k,F as B,j as C,t as l,e as m,g as D,k as d}from"./index-17v5VSGm.js";const N={class:"grid gap-6 lg:grid-cols-[2fr_1fr]"},F={class:"space-y-6"},T={class:"flex flex-wrap items-start gap-3"},P={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},V={key:0,class:"flex items-center justify-between rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},G={key:1,class:"space-y-4"},J={class:"flex flex-wrap items-center justify-between gap-3"},R={class:"text-lg font-semibold text-slate-900"},A={class:"text-xs text-slate-500"},I={class:"flex flex-wrap items-center gap-2 text-xs font-semibold"},L={class:"rounded-full bg-white px-3 py-1 text-slate-600"},M={class:"mt-3 grid gap-3 text-sm sm:grid-cols-2 lg:grid-cols-4"},S={class:"space-y-1 rounded-2xl border border-white/70 bg-white/80 px-3 py-2"},$={class:"text-sm text-slate-700"},q={class:"space-y-1 rounded-2xl border border-white/70 bg-white/80 px-3 py-2"},E={class:"text-sm text-slate-700"},K={class:"space-y-1 rounded-2xl border border-white/70 bg-white/80 px-3 py-2"},O={class:"text-sm text-slate-700"},z={class:"space-y-1 rounded-2xl border border-white/70 bg-white/80 px-3 py-2"},H={class:"text-sm text-slate-700"},Q={class:"mt-4 flex flex-wrap items-center gap-3"},U=["href"],W=["href"],X={class:"space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},ee={__name:"ProfileCompletedJobs",setup(Y){const i=y();b(()=>{!i.user&&i.token&&i.fetchMe().catch(()=>null)});const x=w(()=>[...Array.isArray(i.completedJobs)?i.completedJobs:[]].sort((e,o)=>{const t=new Date((e==null?void 0:e.completed_at)??(e==null?void 0:e.created_at)??0).getTime();return new Date((o==null?void 0:o.completed_at)??(o==null?void 0:o.created_at)??0).getTime()-t})),_=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0});function g(r){if(!r)return"--";try{return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(r))}catch{return r}}function h(r){if(r==null||r==="")return"£0";try{return _.format(Number(r)||0)}catch{return`£${r}`}}function f(r){return r&&(r.invoice_download_url||r.invoice_url||r.invoice||r.invoice_pdf||r.invoice_link)||null}function u(r){return r&&(r.pod_download_url||r.pod_url||r.proof_of_delivery_url)||null}return(r,e)=>{const o=k("RouterLink");return d(),n("div",N,[s("div",F,[s("header",T,[a(v),e[0]||(e[0]=s("div",{class:"space-y-2"},[s("h1",{class:"text-2xl font-bold text-slate-900"},"Completed jobs"),s("p",{class:"text-sm text-slate-600"}," Browse the full history of completed and closed jobs, with quick links to invoices and proof of delivery. ")],-1))]),s("section",P,[x.value.length?(d(),n("div",G,[(d(!0),n(B,null,C(x.value,t=>(d(),n("article",{key:t.id??t.reference??t.job_reference,class:"rounded-2xl border border-slate-200 bg-slate-50 p-4 transition hover:-translate-y-0.5 hover:shadow"},[s("header",J,[s("div",null,[s("h2",R,l(t.title||t.company||t.reference||t.job_reference||"MotorRelay job"),1),s("p",A," Completed "+l(g(t.completed_at||t.updated_at||t.created_at)),1)]),s("div",I,[e[3]||(e[3]=s("span",{class:"rounded-full bg-emerald-100 px-3 py-1 text-emerald-700"},"Completed",-1)),s("span",L,l(h(t.price??t.total??t.amount)),1)])]),s("dl",M,[s("div",S,[e[4]||(e[4]=s("dt",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Pickup",-1)),s("dd",$,l(t.pickup_label||t.pickup_postcode||t.pickup_city||"—"),1)]),s("div",q,[e[5]||(e[5]=s("dt",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Drop-off",-1)),s("dd",E,l(t.dropoff_label||t.dropoff_postcode||t.dropoff_city||"—"),1)]),s("div",K,[e[6]||(e[6]=s("dt",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Reference",-1)),s("dd",O,l(t.reference||t.job_reference||t.id||"—"),1)]),s("div",z,[e[7]||(e[7]=s("dt",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Driver",-1)),s("dd",H,l(t.driver_name||t.driver||t.assigned_driver_name||"Saved in history"),1)])]),s("footer",Q,[f(t)?(d(),n("a",{key:0,href:f(t),target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 rounded-xl border border-emerald-200 bg-white px-3 py-2 text-xs font-semibold text-emerald-700 transition hover:bg-emerald-50"}," View invoice ",8,U)):m("",!0),u(t)?(d(),n("a",{key:1,href:u(t),target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 transition hover:bg-slate-50"}," Proof of delivery ",8,W)):m("",!0),t.id?(d(),D(o,{key:2,to:`/jobs/${t.id}`,class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 transition hover:bg-slate-50"},{default:c(()=>[...e[8]||(e[8]=[p(" Open job detail ",-1)])]),_:1},8,["to"])):m("",!0)])]))),128))])):(d(),n("div",V,[e[2]||(e[2]=s("p",null,"No jobs have been marked completed yet.",-1)),a(o,{to:"/jobs",class:"rounded-xl border border-emerald-200 bg-white px-3 py-2 text-xs font-semibold text-emerald-700 transition hover:bg-emerald-50"},{default:c(()=>[...e[1]||(e[1]=[p(" Find new jobs ",-1)])]),_:1})]))])]),s("aside",X,[e[11]||(e[11]=s("h2",{class:"text-sm font-semibold text-slate-900"},"Need more detail?",-1)),e[12]||(e[12]=s("p",{class:"text-sm text-slate-600"}," Completed jobs store invoice and delivery evidence. Keep them updated to generate professional paperwork in seconds. ",-1)),a(o,{to:"/invoices",class:"inline-flex items-center justify-center rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm font-semibold text-emerald-700 transition hover:bg-emerald-100"},{default:c(()=>[...e[9]||(e[9]=[p(" Go to invoices ",-1)])]),_:1}),a(o,{to:"/profile",class:"inline-flex items-center justify-center rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs font-semibold text-slate-700 transition hover:bg-slate-50"},{default:c(()=>[...e[10]||(e[10]=[p(" Back to profile ",-1)])]),_:1})])])}}};export{ee as default};
