import{_ as me}from"./ProfileScorecard-B-0xYZsd.js";import{u as ge,r as j,o as ve,c as b,a as p,b as r,d as fe,e as x,f as O,g as q,w as N,h as R,i as y,R as C,F as D,j as P,t as u,n as J,k as c}from"./index-17v5VSGm.js";import{f as he}from"./jobs-rqOJ3JE0.js";const be={class:"space-y-6"},xe={class:"grid gap-6 rounded-2xl border bg-white p-6 shadow md:grid-cols-3"},ye={class:"md:col-span-2 space-y-6"},_e={class:"mt-4 flex flex-wrap gap-3"},ke={key:0,class:"mt-6"},we={class:"mt-4 grid gap-4 lg:grid-cols-2"},Ae={class:"space-y-3"},Ne={class:"flex flex-wrap items-start justify-between gap-3"},Ce={class:"text-xl font-semibold text-slate-900"},$e={class:"mt-1 text-sm text-slate-700"},Se={key:0,class:"grid gap-3 rounded-2xl border border-white/60 bg-white/70 p-3 text-sm text-slate-700"},De={class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},Pe={class:"text-sm font-semibold text-slate-900"},Te={key:0,class:"text-xs text-slate-500"},Le={key:0,class:"grid grid-cols-2 gap-3 text-xs text-slate-500"},Ie={class:"font-semibold text-slate-600"},Re={class:"mt-1 text-base font-semibold text-slate-900"},Be={key:1,class:"mt-6"},Fe={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Me={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},Ue={class:"space-y-2"},Oe={class:"flex flex-wrap items-center gap-2 text-xs font-semibold text-slate-600"},qe={class:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-1 text-emerald-700"},Ee={class:"rounded-xl border border-slate-200 px-3 py-1"},Ge={class:"rounded-xl border border-slate-200 px-3 py-1"},Ve={class:"mt-4 grid gap-3 sm:grid-cols-2"},Ke={class:"rounded-2xl border border-emerald-100 bg-emerald-50 p-4"},Je={class:"mt-2 text-2xl font-bold text-emerald-900"},We={class:"rounded-2xl border border-sky-100 bg-sky-50 p-4"},He={class:"mt-2 text-2xl font-bold text-sky-900"},ze={key:2,class:"mt-6"},Qe={class:"mt-4 grid gap-3 sm:grid-cols-2 lg:grid-cols-2"},Ye={class:"text-base font-semibold text-slate-900"},Xe={class:"mt-1 text-xs text-slate-600"},Ze={key:0,class:"mt-3 rounded-2xl bg-emerald-50 px-3 py-1.5 text-xs font-semibold text-emerald-700"},je={key:0,class:"mt-auto grid grid-cols-2 gap-2 text-[10px] text-slate-500"},et={class:"font-semibold text-slate-600"},tt={class:"mt-1 text-sm font-semibold text-slate-900"},st={class:"flex flex-col gap-4"},rt={class:"tile rounded-2xl border bg-white p-4"},at={class:"space-y-1 text-sm text-slate-600"},dt={__name:"HomeView",setup(lt){const ee=["?? Improved job matching accuracy","?? This week: 10% off delivery fees (Fri-Sun)","??? Live tracking accuracy upgrades","??? Tip: Use job # to search","??? New fraud checks for payouts"],te=[{id:"demo-1",price:72,pickup_label:"Camden",dropoff_label:"Croydon"},{id:"demo-2",price:60,pickup_label:"Reading",dropoff_label:"Guildford"},{id:"demo-3",price:120,pickup_label:"Leeds",dropoff_label:"Bradford"}],l=ge(),B=j([]),W=j(!1);ve(async()=>{!l.user&&l.token&&await l.fetchMe().catch(()=>null),W.value=!0;try{const e=await he();B.value=Array.isArray(e==null?void 0:e.jobs)?e.jobs:[]}catch(e){console.error("Failed to load highlight jobs",e),B.value=[]}finally{W.value=!1}}),b(()=>{var t;return((t=B.value)!=null&&t.length?B.value:te).slice(0,3)});const se=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}),re=new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short"});function T(e){if(Array.isArray(e))return e.length;const t=Number(e);return Number.isFinite(t)?t:0}function g(e,t=0){const s=Number(e);return Number.isFinite(s)?s:t}function H(e){if(!e)return null;try{return re.format(new Date(e))}catch{return null}}const ae=new Intl.DateTimeFormat("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1});function E(e){if(!e)return null;if(e instanceof Date)return Number.isNaN(e.getTime())?null:e;const t=new Date(e);return Number.isNaN(t.getTime())?null:t}function z(e){const t=E(e);if(!t)return null;try{return ae.format(t)}catch{try{return t.toLocaleString("en-GB")}catch{return String(e)}}}function G(...e){const t=l.usage||{},s=e.flat().filter(Boolean);for(const o of s){const n=t[o];if(n!=null&&n!=="")return n}return null}function le(e){return e?String(e).replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):""}const V=b(()=>{var t;const e=l.postedJobs??((t=l.jobs)==null?void 0:t.posted);return Array.isArray(e)?e:[]}),ne=b(()=>V.value.length),oe=b(()=>V.value.filter(e=>{const t=String((e==null?void 0:e.status)??"").toLowerCase();return t==="open"||t==="pending"}).length),ie=b(()=>V.value.filter(e=>{const t=E(e==null?void 0:e.goes_live_at);return!!t&&t.getTime()>Date.now()}).length),de=b(()=>{var t;const e=l.completedJobs??((t=l.jobs)==null?void 0:t.completed);return T(e)});b(()=>T(l.assignedJobs));const ce=b(()=>Q(l.plan,l.planSlug||"MotorRelay plan"));function ue(e){return!Array.isArray(e)||!e.length?null:e.map(s=>{const o=(s==null?void 0:s.pickup_at)??(s==null?void 0:s.pickup_time)??(s==null?void 0:s.start_at)??(s==null?void 0:s.start_time)??(s==null?void 0:s.scheduled_at)??(s==null?void 0:s.assigned_at)??(s==null?void 0:s.created_at),n=E(o);return{job:s,pickup:n}}).sort((s,o)=>{const n=s.pickup?s.pickup.getTime():Number.POSITIVE_INFINITY,d=o.pickup?o.pickup.getTime():Number.POSITIVE_INFINITY;return n-d})[0]||null}function Q(e,t="MotorRelay plan"){return e?typeof e=="string"?e:e.name||e.title||t:t}function Y(e,t){if(!Array.isArray(e)||!Array.isArray(t)||!t.length)return 0;const s=new Set(t.map(o=>String(o).toLowerCase()));return e.reduce((o,n)=>{const d=String((n==null?void 0:n.status)??"").toLowerCase();return s.has(d)?o+1:o},0)}const F=b(()=>{var Z;if(!l.isAuthenticated)return[];const e=l.usage||{},t=l.planLimits||{},s=T(l.assignedJobs),o=Y(l.assignedJobs,["assigned","accepted","in_progress"]),n=T(l.completedJobs),d=T(l.postedJobs),K=g(e.job_posts_this_month??e.jobPostsThisMonth??d),i=g(e.urgent_boosts_used??e.urgentBoostsUsed),a=g(e.applications_today??e.applicationsToday),h=g(e.planner_entries??e.plannerEntries),_=g(e.pending_invoices??e.pendingInvoices??e.unpaid_invoices??e.unpaidInvoices),k=g(e.invoices_completed??e.invoicesCompleted,null),m=g(e.unread_threads??e.unreadThreads??e.unread_messages??e.unreadMessages),w=g(e.pending_applications??e.pendingApplications),A=g(e.pending_account_requests??e.pendingAccountRequests??e.account_updates_pending),v=g(e.system_alerts??e.systemAlerts??e.platform_alerts??e.platformAlerts),$=g(t.monthly_job_posts??t.monthlyJobPosts??t.job_posts_per_month,0),M=$?Math.max($-K,0):null,U=Q(l.plan),f=H((Z=l.user)==null?void 0:Z.updated_at),L=[];if(l.role==="driver"?L.push({to:"/driver",title:"Driver dashboard",description:"Snapshot of your runs and earnings",snippet:`Active runs: ${o}`,metrics:[{label:"Active runs",value:o},{label:"Completed",value:n}]},{to:"/jobs",title:"My jobs",description:"Review applications, assignments, and history",snippet:`Assignments today: ${o} � Completed: ${n}`,metrics:[{label:"Assigned",value:s},{label:"Completed",value:n}]},{to:"/planner",title:"Planner",description:"Hold dates, routes, and availability",snippet:h?`Saved holds: ${h}`:"Plan your week with route holds",metrics:h?[{label:"Saved holds",value:h}]:[]},{to:"/account",title:"Account settings",description:"Request updates to your details",snippet:f?`Last updated ${f}`:"Keep your driver profile current",metrics:f?[{label:"Updated",value:f}]:[]}):l.role==="dealer"?L.push({to:"/dealer",title:"Dealer dashboard",description:"Monitor posted runs, plan usage, and application trends",snippet:`Posted jobs: ${d} � Active drivers: ${s}`,metrics:[{label:"Active postings",value:d},{label:"Plan",value:U}]},{to:"/profile",title:"Account overview",description:"Usage, plan limits, and recent activity",snippet:`Current plan: ${U}`,metrics:[{label:"Job posts this month",value:K},{label:"Applications today",value:a}]},{to:"/jobs/new",title:"Create job",description:"Post a run in under two minutes",snippet:M!==null?`${M} posts remaining this month`:"Unlimited job posts available",metrics:[{label:"Active postings",value:d},{label:"Urgent boosts used",value:i}]},{to:"/messages",title:"Messages",description:"Coordinate with drivers instantly",snippet:m?`${m} unread conversations`:"All conversations cleared",metrics:[{label:"Unread",value:m}]},{to:"/account",title:"Account settings",description:"Request updates to your company info",snippet:f?`Last updated ${f}`:"Keep company details up to date",metrics:f?[{label:"Updated",value:f}]:[]}):l.role==="admin"&&L.push({to:"/admin",title:"Admin portal",description:"Manage applications, content, and teams",snippet:w?`${w} applications waiting`:"All applications reviewed",metrics:[{label:"Open applications",value:w}]},{to:"/admin/account-requests",title:"Account updates",description:"Review change requests from users",snippet:A?`${A} requests awaiting review`:"No pending account updates",metrics:[{label:"Pending requests",value:A}]},{to:"/admin/system-health",title:"System health",description:"Monitor platform status and uptime",snippet:v?`${v} active alerts`:"System operating normally",metrics:[{label:"Active alerts",value:v}]},{to:"/messages",title:"Messages",description:"Keep conversations moving with your team",snippet:m?`${m} unread conversations`:"Inbox clear",metrics:[{label:"Unread",value:m}]}),["driver","dealer","admin"].includes(l.role)){const S=[{label:"Pending",value:_}];k!==null&&S.push({label:"Completed",value:k}),L.push({to:"/invoices",title:"Invoices",description:"Generate or download POD-ready invoices",snippet:_?`${_} awaiting action`:"All invoices are up to date",metrics:S})}return L.map(S=>({...S,metrics:Array.isArray(S.metrics)?S.metrics.filter(I=>I&&I.label&&I.value!==null&&I.value!==void 0&&I.value!==""):[]}))}),X=b(()=>{if(!l.isAuthenticated)return[];const e=l.usage||{},t=Array.isArray(l.assignedJobs)?l.assignedJobs:[],s=Array.isArray(l.completedJobs)?l.completedJobs:[],o=Y(t,["assigned","accepted","in_progress"]),n=F.value.find(i=>i.to==="/driver"),d=[];if(l.role==="driver"&&n){const i=ue(t),a=(i==null?void 0:i.job)??null,h=(i==null?void 0:i.pickup)??null,_=(a==null?void 0:a.pickup_label)||(a==null?void 0:a.pickup_postcode)||(a==null?void 0:a.pickup_town)||(a==null?void 0:a.pickup_city)||null,k=(a==null?void 0:a.dropoff_label)||(a==null?void 0:a.dropoff_postcode)||(a==null?void 0:a.dropoff_town)||(a==null?void 0:a.dropoff_city)||null,m=a&&a.price!==void 0&&a.price!==null?se.format(Number(a.price)||0):null,w=a!=null&&a.status?le(a.status):null,A=(a==null?void 0:a.reference)||(a==null?void 0:a.job_reference)||(a==null?void 0:a.id)||null,v=Array.isArray(n.metrics)&&n.metrics.length?n.metrics:[{label:"Active runs",value:o},{label:"Completed",value:s.length}],$=[h?{label:"Next pickup",value:z(h),secondary:_||void 0}:_?{label:"Next pickup",value:_}:null,k?{label:"Drop-off",value:k}:null,m?{label:"Job value",value:m}:null,w?{label:"Status",value:w}:null,A?{label:"Reference",value:A}:null].filter(Boolean);d.push({key:"driver-dashboard",to:n.to,title:n.title,description:n.description||"Live runs, earnings, mileage, and POD uploads.",highlight:n.snippet||(o?`Active runs: ${o}`:"Review current assignments and earnings"),stats:v,details:$,accent:"emerald"})}if(l.role==="driver"||l.hasPlannerAccess){const i=F.value.find(v=>v.to==="/planner"),a=g(e.planner_entries??e.plannerEntries,0),h=g(G("planner_routes_this_week","plannerRoutesThisWeek","routes_this_week","routesThisWeek"),null),_=G("planner_next_date","plannerNextDate","planner_next","next_hold_date","upcoming_hold_date","next_availability"),k=z(_)||H(_),m=G("planner_next_location","plannerNextLocation","planner_next_route","planner_next_label","plannerNextRoute"),w=Array.isArray(i==null?void 0:i.metrics)&&i.metrics.length?i.metrics:[{label:"Saved holds",value:a},{label:"Routes this week",value:h??"-"}],A=[k||m?{label:"Next hold",value:k||m,secondary:k&&m?m:void 0}:null,{label:"Saved holds",value:a},h!==null?{label:"Routes this week",value:h}:null].filter(Boolean).filter((v,$,M)=>{const U=`${v.label}-${v.value}-${v.secondary??""}`;return M.findIndex(f=>`${f.label}-${f.value}-${f.secondary??""}`===U)===$&&v.value!==void 0});d.push({key:"planner",to:i?i.to:"/planner",title:(i==null?void 0:i.title)||"Planner",description:(i==null?void 0:i.description)||"Keep availability, holds, and recurring routes organised for your team.",highlight:(i==null?void 0:i.snippet)||(a?`${a} saved holds ready to action`:"Create route holds to reserve capacity"),stats:w,details:A,accent:"sky"})}return d}),pe=b(()=>l.isAuthenticated&&l.role==="admin"?F.value.length>0:!1);return(e,t)=>(c(),p("div",be,[r("section",xe,[r("div",ye,[r("div",null,[t[13]||(t[13]=r("h1",{class:"text-3xl font-extrabold text-slate-900"},"Welcome to MotorRelay",-1)),t[14]||(t[14]=r("p",{class:"mt-2 text-slate-600"}," Connect dealerships with trusted delivery drivers. Post jobs, accept runs, and get paid fast. ",-1)),r("div",_e,[O(y(C),{to:"/jobs",class:"tile inline-flex items-center gap-2 rounded-xl border bg-white px-4 py-2 text-emerald-700 shadow-sm hover:bg-slate-50"},{default:N(()=>[...t[0]||(t[0]=[R(" Find Jobs ",-1)])]),_:1}),y(l).isDealer||y(l).role==="admin"?(c(),q(y(C),{key:0,to:"/jobs/new",class:"tile inline-flex items-center gap-2 rounded-xl border bg-white px-4 py-2 text-emerald-700 shadow-sm hover:bg-slate-50"},{default:N(()=>[...t[1]||(t[1]=[R(" Create Job ",-1)])]),_:1})):x("",!0),O(y(C),{to:"/membership",class:"tile inline-flex items-center gap-2 rounded-xl border bg-white px-4 py-2 text-emerald-700 shadow-sm hover:bg-slate-50"},{default:N(()=>[...t[2]||(t[2]=[R(" Membership ",-1)])]),_:1})]),X.value.length?(c(),p("div",ke,[t[3]||(t[3]=r("h2",{class:"text-sm font-semibold uppercase tracking-wide text-slate-500"},"Featured workspaces",-1)),r("div",we,[(c(!0),p(D,null,P(X.value,s=>(c(),q(y(C),{key:s.key,to:s.to,class:J(["group flex flex-col justify-between gap-4 rounded-3xl border p-5 text-left shadow-sm transition hover:-translate-y-1 hover:shadow-lg lg:min-h-[220px]",[s.accent==="emerald"?"border-emerald-200 bg-emerald-50":s.accent==="sky"?"border-sky-200 bg-sky-50":"border-slate-200 bg-slate-50"]])},{default:N(()=>{var o,n;return[r("div",Ae,[r("div",Ne,[r("div",null,[r("h3",Ce,u(s.title),1),r("p",$e,u(s.description),1)]),s.highlight?(c(),p("span",{key:0,class:J(["inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold bg-white/70 transition",s.accent==="sky"?"border-sky-200 text-sky-700":s.accent==="emerald"?"border-emerald-200 text-emerald-700":"border-slate-200 text-slate-700"])},u(s.highlight),3)):x("",!0)]),(o=s.details)!=null&&o.length?(c(),p("div",Se,[(c(!0),p(D,null,P(s.details,d=>(c(),p("div",{key:`${s.key}-${d.label}-${d.value}`,class:"flex flex-col gap-1 rounded-2xl bg-white/70 px-3 py-2"},[r("span",De,u(d.label),1),r("span",Pe,u(d.value),1),d.secondary?(c(),p("span",Te,u(d.secondary),1)):x("",!0)]))),128))])):x("",!0)]),(n=s.stats)!=null&&n.length?(c(),p("dl",Le,[(c(!0),p(D,null,P(s.stats,d=>(c(),p("div",{key:`${s.key}-stat-${d.label}`,class:"rounded-2xl border border-white/60 bg-white/70 px-3 py-2"},[r("dt",Ie,u(d.label),1),r("dd",Re,u(d.value),1)]))),128))])):x("",!0),r("div",{class:J(["mt-2 text-xs font-semibold transition group-hover:underline",s.accent==="sky"?"text-sky-700":s.accent==="emerald"?"text-emerald-700":"text-slate-700"])}," Open "+u(s.title),3)]}),_:2},1032,["to","class"]))),128))])])):x("",!0),y(l).role==="dealer"?(c(),p("div",Be,[r("section",Fe,[r("header",Me,[r("div",Ue,[t[5]||(t[5]=r("h2",{class:"text-xl font-semibold text-slate-900"},"Dealer dashboard",-1)),t[6]||(t[6]=r("p",{class:"text-sm text-slate-600"}," Overview of your MotorRelay runs, plan usage, and team activity. ",-1)),O(y(C),{to:"/dealer",class:"inline-flex items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs font-semibold text-emerald-700 transition hover:bg-emerald-100 md:hidden"},{default:N(()=>[...t[4]||(t[4]=[R(" Open full dashboard ",-1),r("span",{"aria-hidden":"true"},"?",-1)])]),_:1})]),r("div",Oe,[r("span",qe,u(ce.value),1),r("span",Ee," Posted jobs: "+u(ne.value),1),r("span",Ge," Completed: "+u(de.value),1),O(y(C),{to:"/dealer",class:"hidden items-center gap-2 rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-1 text-emerald-700 transition hover:bg-emerald-100 md:inline-flex"},{default:N(()=>[...t[7]||(t[7]=[R(" Open full dashboard ",-1),r("span",{"aria-hidden":"true"},"?",-1)])]),_:1})])]),r("div",Ve,[r("div",Ke,[t[8]||(t[8]=r("h3",{class:"text-xs font-semibold uppercase tracking-wide text-emerald-700"},"Open marketplace jobs",-1)),r("p",Je,u(oe.value),1),t[9]||(t[9]=r("p",{class:"text-xs text-emerald-700"}," Keep an eye on runs that still need drivers. ",-1))]),r("div",We,[t[10]||(t[10]=r("h3",{class:"text-xs font-semibold uppercase tracking-wide text-sky-700"},"Awaiting go-live",-1)),r("p",He,u(ie.value),1),t[11]||(t[11]=r("p",{class:"text-xs text-sky-700"}," Schedule adjustments still possible before they publish. ",-1))])])])])):x("",!0),pe.value?(c(),p("div",ze,[t[12]||(t[12]=r("h2",{class:"text-sm font-semibold uppercase tracking-wide text-slate-500"},"Quick workspace",-1)),r("div",Qe,[(c(!0),p(D,null,P(F.value,s=>(c(),q(y(C),{key:s.to,to:s.to,class:"group flex min-h-[160px] flex-col gap-3 rounded-2xl border border-slate-200 bg-white px-4 py-4 text-left shadow-sm transition hover:-translate-y-1 hover:shadow-lg"},{default:N(()=>{var o;return[r("div",null,[r("div",Ye,u(s.title),1),r("p",Xe,u(s.description),1),s.snippet?(c(),p("p",Ze,u(s.snippet),1)):x("",!0)]),(o=s.metrics)!=null&&o.length?(c(),p("dl",je,[(c(!0),p(D,null,P(s.metrics,n=>(c(),p("div",{key:`${s.to}-${n.label}`,class:"rounded-xl border border-slate-100 bg-slate-50 px-3 py-1.5"},[r("dt",et,u(n.label),1),r("dd",tt,u(n.value),1)]))),128))])):x("",!0)]}),_:2},1032,["to"]))),128))])])):x("",!0)]),t[15]||(t[15]=fe('<div class="grid grid-cols-2 gap-4 md:grid-cols-3"><div class="tile rounded-2xl bg-emerald-50 p-4"><div class="font-semibold text-emerald-900">Post or accept runs</div><div class="text-sm text-emerald-700">Dealers post, drivers deliver.</div></div><div class="tile rounded-2xl bg-emerald-50 p-4"><div class="font-semibold text-emerald-900">Built-in messaging</div><div class="text-sm text-emerald-700">Keep chats tidy.</div></div><div class="tile rounded-2xl bg-emerald-50 p-4"><div class="font-semibold text-emerald-900">Instant invoices</div><div class="text-sm text-emerald-700">One click to print.</div></div></div>',1))]),r("aside",st,[y(l).role==="dealer"?(c(),q(me,{key:0})):x("",!0),r("div",rt,[t[16]||(t[16]=r("div",{class:"mb-1 font-semibold text-slate-900"},"Updates",-1)),r("ul",at,[(c(),p(D,null,P(ee,(s,o)=>r("li",{key:o},u(s),1)),64))])])])])]))}};export{dt as default};
