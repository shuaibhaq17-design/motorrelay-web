import{u as $,r as v,c as R,o as P,l as S,a as r,b as o,g as n,f as x,i,w as f,h as _,R as y,F as A,j as J,n as V,t as d,m as h,p as D,k as t}from"./index-CbeUM-tk.js";import{a as L,m as W}from"./jobs-BugcPTwM.js";const j={class:"space-y-4"},E={class:"flex flex-col justify-between gap-3 md:flex-row md:items-center"},G={class:"flex flex-wrap items-center gap-2"},I={class:"inline-flex overflow-hidden rounded-2xl border border-slate-200"},z=["onClick"],O={key:0,class:"text-sm text-amber-600"},T={key:1,class:"rounded-2xl border bg-white p-4 text-sm text-slate-600"},U={key:2,class:"rounded-2xl border bg-white p-4 text-sm text-slate-600"},q={key:3,class:"grid gap-4 md:grid-cols-2"},H=["onClick"],K={class:"flex items-start justify-between gap-3"},Q={class:"text-lg font-semibold text-slate-900"},X={class:"text-sm text-slate-600"},Y={class:"text-xs text-slate-500"},Z={class:"badge bg-slate-100 text-slate-800"},ee={class:"mt-3 flex flex-wrap gap-2"},te=["onClick"],se=["onClick"],oe=["onClick"],ae=["onClick"],ie={__name:"JobsIndex",setup(le){const c=$(),B=D(),a=v("available"),u=v([]),k=v(!1),m=v(""),w={available:[{id:"demo-1",price:72,status:"open",company:"Acme Motors",vehicle_make:"Ford Fiesta",distance_mi:12,pickup_postcode:"NW1",dropoff_postcode:"CR0"}],current:[{id:"demo-2",price:105,status:"in_transit",company:"City Cars",vehicle_make:"BMW 1 Series",distance_mi:46,pickup_postcode:"SW1",dropoff_postcode:"CB1"}],completed:[{id:"demo-3",price:88,status:"delivered",company:"Midlands Auto",vehicle_make:"Audi A3",distance_mi:30,pickup_postcode:"B1",dropoff_postcode:"LE1"}]},F=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0});async function g(){k.value=!0,m.value="";try{const s=await L({scope:a.value});u.value=Array.isArray(s==null?void 0:s.data)?s.data:Array.isArray(s==null?void 0:s.jobs)?s.jobs:[],u.value.length||(u.value=w[a.value]??[])}catch(s){console.error("Failed to load jobs",s),m.value="Unable to load jobs. Showing sample data.",u.value=w[a.value]??[]}finally{k.value=!1}}async function b(s,l){try{await W(s.id,l),await g()}catch(e){console.error("Job mutation failed",e),alert("We could not update this job. Please try again.")}}function M(s){B.push({name:"job-detail",params:{id:s.id}})}const C=R(()=>u.value??[]),N=[{key:"available",label:"Available"},{key:"current",label:"Current"},{key:"completed",label:"Completed"}];return P(async()=>{!c.user&&c.token&&await c.fetchMe().catch(()=>null),await g()}),S(a,g),(s,l)=>(t(),r("div",j,[o("div",E,[l[2]||(l[2]=o("div",null,[o("h1",{class:"text-2xl font-bold text-slate-900"},"Jobs"),o("p",{class:"text-sm text-slate-600"},"Review and manage MotorRelay runs.")],-1)),o("div",G,[i(c).isDealer||i(c).role==="admin"?(t(),x(i(y),{key:0,to:"/jobs/new",class:"rounded-xl border border-slate-200 px-3 py-2 text-sm font-semibold hover:bg-slate-50"},{default:f(()=>[...l[0]||(l[0]=[_(" + Create Job ",-1)])]),_:1})):n("",!0),i(c).hasPlannerAccess?(t(),x(i(y),{key:1,to:"/planner",class:"rounded-xl border border-slate-200 px-3 py-2 text-sm font-semibold hover:bg-slate-50"},{default:f(()=>[...l[1]||(l[1]=[_(" Planner ",-1)])]),_:1})):n("",!0),o("div",I,[(t(),r(A,null,J(N,e=>o("button",{key:e.key,type:"button",class:V(["px-3 py-2 text-sm font-semibold transition",a.value===e.key?"bg-emerald-600 text-white":"text-slate-600 hover:bg-slate-100"]),onClick:p=>a.value=e.key},d(e.label),11,z)),64))])])]),m.value?(t(),r("p",O,d(m.value),1)):n("",!0),k.value?(t(),r("div",T," Loading jobs… ")):C.value.length?(t(),r("div",q,[(t(!0),r(A,null,J(C.value,e=>(t(),r("button",{key:e.id,type:"button",class:"tile w-full cursor-pointer text-left p-4 transition hover:-translate-y-0.5 hover:shadow-md",onClick:p=>M(e)},[o("div",K,[o("div",null,[o("div",Q,d(i(F).format(Number(e.price??0))),1),o("p",X,d(e.company||"Customer")+" · "+d(e.vehicle_make||"Vehicle")+" · "+d(e.distance_mi||"—")+" mi ",1),o("p",Y,d(e.pickup_postcode||"??")+" → "+d(e.dropoff_postcode||"??"),1)]),o("span",Z,d(e.status),1)]),o("div",ee,[a.value==="current"||a.value==="completed"?(t(),x(i(y),{key:0,to:{name:"job-detail",params:{id:e.id}},class:"rounded-xl border border-slate-200 px-3 py-2 text-sm font-semibold hover:bg-slate-50"},{default:f(()=>[...l[3]||(l[3]=[_(" Open ",-1)])]),_:1},8,["to"])):n("",!0),a.value==="available"&&!i(c).isDealer?(t(),r("button",{key:1,type:"button",class:"rounded-xl bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:bg-emerald-700",onClick:h(p=>b(e,"accept"),["stop"])}," Pick this job ",8,te)):n("",!0),a.value==="current"?(t(),r("button",{key:2,type:"button",class:"rounded-xl border border-slate-200 px-3 py-2 text-sm font-semibold hover:bg-slate-50",onClick:h(p=>b(e,"collected"),["stop"])}," Collected ",8,se)):n("",!0),a.value==="current"?(t(),r("button",{key:3,type:"button",class:"rounded-xl bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:bg-emerald-700",onClick:h(p=>b(e,"delivered"),["stop"])}," Job completed ",8,oe)):n("",!0),a.value==="current"?(t(),r("button",{key:4,type:"button",class:"rounded-xl border border-red-300 px-3 py-2 text-sm font-semibold text-red-700 hover:bg-red-50",onClick:h(p=>b(e,"cancel"),["stop"])}," Cancel ",8,ae)):n("",!0),a.value==="completed"?(t(),x(i(y),{key:5,to:`/invoices/from-job/${e.id}`,class:"rounded-xl border border-slate-200 px-3 py-2 text-sm font-semibold hover:bg-slate-50"},{default:f(()=>[...l[4]||(l[4]=[_(" View invoice ",-1)])]),_:1},8,["to"])):n("",!0)])],8,H))),128))])):(t(),r("div",U," No jobs here yet. "))]))}};export{ie as default};
