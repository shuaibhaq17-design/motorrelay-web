import{y as k,u as D,r as _,o as j,a as d,b as t,e as I,t as l,F as f,j as w,n as g,k as o}from"./index-17v5VSGm.js";async function F(){const{data:x}=await k.get("/invoices");return x}async function L(x){return await k.get(`/invoices/${x}/download`,{responseType:"blob"})}const $={class:"space-y-4"},C={key:0,class:"text-sm text-amber-600"},A={key:1,class:"rounded-2xl border bg-white p-4 text-sm text-slate-600"},B={key:2,class:"rounded-2xl border border-dashed border-slate-200 bg-white p-6 text-sm text-slate-600"},N={key:3,class:"space-y-4"},S={class:"hidden md:block"},J={class:"min-w-full divide-y divide-slate-200 overflow-hidden rounded-2xl border bg-white"},P={class:"divide-y divide-slate-200 text-sm text-slate-700"},R={class:"px-4 py-3 font-semibold text-slate-900"},T={class:"px-4 py-3"},U={class:"font-medium text-slate-800"},G={class:"text-xs text-slate-500"},M={class:"px-4 py-3"},V={class:"px-4 py-3"},z={class:"px-4 py-3"},E={class:"px-4 py-3"},O={class:"px-4 py-3"},W={class:"px-4 py-3 text-right"},q=["disabled","onClick"],H={key:0},K={key:1},Q={class:"space-y-3 md:hidden"},X={class:"flex items-center justify-between gap-3"},Y={class:"text-sm font-semibold text-slate-900"},Z={class:"text-xs text-slate-500"},tt={class:"mt-3 grid gap-2 text-xs text-slate-600"},et={class:"text-sm font-medium text-slate-900"},st={class:"flex items-center justify-between"},at={class:"text-sm font-semibold text-slate-900"},lt={class:"flex items-center justify-between"},dt={class:"text-sm font-semibold text-slate-900"},ot={class:"flex items-center justify-between"},nt={class:"text-sm font-semibold text-emerald-700"},rt=["disabled","onClick"],ct={key:0},it={key:1},pt={__name:"InvoicesIndex",setup(x){const b=D(),c=_([]),y=_(!1),i=_(null),p=_("");function u(a,s="GBP"){try{return new Intl.NumberFormat("en-GB",{style:"currency",currency:s||"GBP",maximumFractionDigits:2}).format(Number(a||0))}catch{return`${s} ${Number(a||0).toFixed(2)}`}}async function v(){if(!b.token){p.value="Log in to view invoices.",c.value=[];return}y.value=!0,p.value="";try{const a=await F();c.value=Array.isArray(a==null?void 0:a.data)?a.data:[]}catch(a){console.error("Failed to load invoices",a),p.value="Unable to load invoices right now.",c.value=[]}finally{y.value=!1}}async function h(a){if(a!=null&&a.id){i.value=a.id;try{const s=await L(a.id),e=new Blob([s.data],{type:"application/pdf"}),r=window.URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=`${a.number||a.id}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}catch(s){console.error("Failed to download invoice",s),alert("We could not download this invoice. Please try again later.")}finally{i.value=null}}}return j(async()=>{!b.user&&b.token&&await b.fetchMe().catch(()=>null),v()}),(a,s)=>(o(),d("div",$,[s[5]||(s[5]=t("header",null,[t("h1",{class:"text-2xl font-bold text-slate-900"},"Invoices"),t("p",{class:"text-sm text-slate-600"}," Generate and share MotorRelay invoices instantly after each delivery. ")],-1)),p.value?(o(),d("p",C,l(p.value),1)):I("",!0),y.value?(o(),d("div",A," Loading invoices... ")):c.value.length?(o(),d("div",N,[t("div",S,[t("table",J,[s[0]||(s[0]=t("thead",{class:"bg-slate-50"},[t("tr",{class:"text-left text-xs font-semibold uppercase tracking-wide text-slate-500"},[t("th",{class:"px-4 py-3"},"Invoice"),t("th",{class:"px-4 py-3"},"Job"),t("th",{class:"px-4 py-3"},"Subtotal"),t("th",{class:"px-4 py-3"},"VAT"),t("th",{class:"px-4 py-3"},"Total"),t("th",{class:"px-4 py-3"},"Status"),t("th",{class:"px-4 py-3"},"Issued"),t("th",{class:"px-4 py-3 sr-only"},"Actions")])],-1)),t("tbody",P,[(o(!0),d(f,null,w(c.value,e=>{var r,n,m;return o(),d("tr",{key:e.id},[t("td",R,l(e.number||e.id),1),t("td",T,[t("div",U,l(((r=e.job)==null?void 0:r.title)||`Job #${((n=e.job)==null?void 0:n.id)??"--"}`),1),t("div",G," Job ID: "+l(((m=e.job)==null?void 0:m.id)??"--"),1)]),t("td",M,l(u(e.subtotal,e.currency)),1),t("td",V,l(u(e.vat_total,e.currency)),1),t("td",z,l(u(e.total,e.currency)),1),t("td",E,[t("span",{class:g(["badge",{"bg-emerald-100 text-emerald-700":e.status==="finalized","bg-amber-100 text-amber-700":e.status==="draft","bg-slate-200 text-slate-700":!e.status}])},l(e.status||"draft"),3)]),t("td",O,l(e.issued_at?new Date(e.issued_at).toLocaleDateString():"--"),1),t("td",W,[t("button",{type:"button",class:"rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",disabled:!e.pdf_available||i.value===e.id,onClick:ut=>h(e)},[i.value===e.id?(o(),d("span",H,"Downloading...")):(o(),d("span",K,"Download PDF"))],8,q)])])}),128))])])]),t("div",Q,[(o(!0),d(f,null,w(c.value,e=>{var r,n;return o(),d("article",{key:`card-${e.id}`,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[t("header",X,[t("div",null,[t("p",Y,l(e.number||e.id),1),t("p",Z,l(e.issued_at?new Date(e.issued_at).toLocaleDateString():"Not issued"),1)]),t("span",{class:g(["badge",{"bg-emerald-100 text-emerald-700":e.status==="finalized","bg-amber-100 text-amber-700":e.status==="draft","bg-slate-200 text-slate-700":!e.status}])},l(e.status||"draft"),3)]),t("dl",tt,[t("div",null,[s[1]||(s[1]=t("dt",{class:"font-semibold uppercase tracking-wide text-slate-500"},"Job",-1)),t("dd",et,l(((r=e.job)==null?void 0:r.title)||`Job #${((n=e.job)==null?void 0:n.id)??"--"}`),1)]),t("div",st,[s[2]||(s[2]=t("dt",{class:"font-semibold uppercase tracking-wide text-slate-500"},"Subtotal",-1)),t("dd",at,l(u(e.subtotal,e.currency)),1)]),t("div",lt,[s[3]||(s[3]=t("dt",{class:"font-semibold uppercase tracking-wide text-slate-500"},"VAT",-1)),t("dd",dt,l(u(e.vat_total,e.currency)),1)]),t("div",ot,[s[4]||(s[4]=t("dt",{class:"font-semibold uppercase tracking-wide text-slate-500"},"Total",-1)),t("dd",nt,l(u(e.total,e.currency)),1)])]),t("button",{type:"button",class:"mt-3 w-full rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",disabled:!e.pdf_available||i.value===e.id,onClick:m=>h(e)},[i.value===e.id?(o(),d("span",ct,"Downloading...")):(o(),d("span",it,"Download PDF"))],8,rt)])}),128))])])):(o(),d("div",B," No invoices yet. Approved jobs will appear here once completion is signed off. "))]))}};export{pt as default};
