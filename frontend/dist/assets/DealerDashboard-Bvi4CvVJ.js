import{u as T,o as L,c as l,a as d,b as s,f as i,t as a,F as b,j as y,g as $,w as p,h as u,i as c,R as x,e as P,k as n}from"./index-17v5VSGm.js";import{_ as R}from"./ProfileScorecard-B-0xYZsd.js";const V={class:"grid gap-6 lg:grid-cols-[2fr_1fr]"},B={class:"space-y-6"},O={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},F={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},G={class:"flex flex-wrap items-center gap-3 text-sm text-slate-600"},E={class:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-1 font-semibold text-emerald-700"},I={class:"rounded-xl border border-slate-200 px-3 py-1"},U={class:"rounded-xl border border-slate-200 px-3 py-1"},q={class:"mt-4 grid gap-3 sm:grid-cols-2"},K={class:"rounded-2xl border border-emerald-100 bg-emerald-50 p-4"},Q={class:"mt-2 text-2xl font-bold text-emerald-900"},Y={class:"rounded-2xl border border-sky-100 bg-sky-50 p-4"},z={class:"mt-2 text-2xl font-bold text-sky-900"},H={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},W={class:"mt-4 grid gap-4 sm:grid-cols-2"},X={class:"flex items-center gap-2 text-base font-semibold text-slate-900"},Z={"aria-hidden":"true"},j={class:"mt-2 text-xs text-slate-600"},ee={class:"text-xs font-semibold text-emerald-600 transition group-hover:underline"},te={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},se={class:"flex items-center justify-between"},re={key:0,class:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},oe={key:1,class:"mt-4 space-y-3"},ae={class:"flex flex-wrap items-center justify-between gap-3"},le={class:"text-base font-semibold text-slate-900"},ne={class:"text-xs text-slate-500"},de={class:"badge bg-slate-100 text-slate-700"},ie={class:"mt-3 flex flex-wrap items-center gap-3 text-xs text-slate-500"},pe={key:0},ue={key:1},ce={class:"mt-3 flex flex-wrap gap-2"},xe={class:"space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},me={class:"space-y-3 text-sm text-slate-600"},he={__name:"DealerDashboard",setup(ge){const o=T();L(()=>{!o.user&&o.token&&o.fetchMe().catch(()=>null)});const m=l(()=>{var e;const t=Array.isArray(o.postedJobs)?o.postedJobs:(e=o.jobs)==null?void 0:e.posted;return Array.isArray(t)?[...t]:[]}),w=l(()=>m.value.filter(t=>{const e=String((t==null?void 0:t.status)??"").toLowerCase();return e==="open"||e==="pending"})),k=l(()=>m.value.filter(t=>{if(!(t!=null&&t.goes_live_at))return!1;const e=new Date(t.goes_live_at);return!Number.isNaN(e.getTime())&&e.getTime()>Date.now()})),D=l(()=>m.value.filter(t=>{const e=String((t==null?void 0:t.status)??"").toLowerCase();return e==="in_progress"||e==="scheduled"||e==="assigned"})),S=l(()=>{var e;const t=Array.isArray(o.completedJobs)?o.completedJobs:(e=o.jobs)==null?void 0:e.completed;return Array.isArray(t)?t:[]}),g=l(()=>o.usage||{}),_=l(()=>Number(g.value.unread_threads??g.value.unreadThreads??g.value.unread_messages??g.value.unreadMessages??0)||0),A=l(()=>o.plan?typeof o.plan=="string"?o.plan:o.plan.name||o.plan.title||o.plan.slug||"MotorRelay plan":o.planSlug||"MotorRelay plan"),h=l(()=>[...D.value].sort((e,r)=>{const f=new Date((e==null?void 0:e.pickup_at)??(e==null?void 0:e.goes_live_at)??(e==null?void 0:e.created_at)??0).getTime(),N=new Date((r==null?void 0:r.pickup_at)??(r==null?void 0:r.goes_live_at)??(r==null?void 0:r.created_at)??0).getTime();return f-N}).slice(0,5)),C=l(()=>[{to:"/jobs/new",label:"Create job",description:"Post a new run for marketplace drivers",icon:"âž•"},{to:"/jobs",label:"Manage jobs",description:"Track open, scheduled, and completed work",icon:"ðŸ“¦"},{to:"/messages",label:"Messages",description:_.value?`${_.value} conversations need a reply`:"Stay in sync with drivers",icon:"âœ‰ï¸"},{to:"/invoices",label:"Invoices",description:"Generate paperwork and POD for deliveries",icon:"ðŸ“„"}]);function J(t){const e=(t==null?void 0:t.pickup_label)||(t==null?void 0:t.pickup_postcode)||(t==null?void 0:t.pickup_city)||"Pickup",r=(t==null?void 0:t.dropoff_label)||(t==null?void 0:t.dropoff_postcode)||(t==null?void 0:t.dropoff_city)||"Drop-off";return`${e} â†’ ${r}`}function M(t){return String((t==null?void 0:t.status)??"Scheduled").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function v(t){if(!t)return"--";try{return new Intl.DateTimeFormat("en-GB",{weekday:"short",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch{return t}}return(t,e)=>(n(),d("div",V,[s("div",B,[s("section",O,[s("header",F,[e[0]||(e[0]=s("div",null,[s("h1",{class:"text-2xl font-bold text-slate-900"},"Dealer dashboard"),s("p",{class:"text-sm text-slate-600"}," Overview of your MotorRelay runs and team activity. ")],-1)),s("div",G,[s("span",E,a(A.value),1),s("span",I," Posted jobs: "+a(m.value.length),1),s("span",U," Completed: "+a(S.value.length),1)])]),s("div",q,[s("div",K,[e[1]||(e[1]=s("h2",{class:"text-xs font-semibold uppercase tracking-wide text-emerald-700"},"Open marketplace jobs",-1)),s("p",Q,a(w.value.length),1),e[2]||(e[2]=s("p",{class:"text-xs text-emerald-700"},"Keep an eye on runs that need drivers.",-1))]),s("div",Y,[e[3]||(e[3]=s("h2",{class:"text-xs font-semibold uppercase tracking-wide text-sky-700"},"Awaiting go-live",-1)),s("p",z,a(k.value.length),1),e[4]||(e[4]=s("p",{class:"text-xs text-sky-700"},"Schedule adjustments still possible before they publish.",-1))])])]),s("section",H,[e[5]||(e[5]=s("h2",{class:"text-lg font-semibold text-slate-900"},"Quick workspace",-1)),s("div",W,[(n(!0),d(b,null,y(C.value,r=>(n(),$(c(x),{key:r.to,to:r.to,class:"group flex min-h-[140px] flex-col justify-between rounded-2xl border border-slate-200 bg-slate-50 p-4 text-left transition hover:-translate-y-0.5 hover:bg-white hover:shadow"},{default:p(()=>[s("div",null,[s("div",X,[s("span",Z,a(r.icon),1),u(" "+a(r.label),1)]),s("p",j,a(r.description),1)]),s("span",ee," Open "+a(r.label),1)]),_:2},1032,["to"]))),128))])]),s("section",te,[s("div",se,[e[7]||(e[7]=s("h2",{class:"text-lg font-semibold text-slate-900"},"Upcoming runs",-1)),i(c(x),{to:"/jobs",class:"text-xs font-semibold text-emerald-600 hover:underline"},{default:p(()=>[...e[6]||(e[6]=[u(" Manage jobs ",-1)])]),_:1})]),e[10]||(e[10]=s("p",{class:"mt-1 text-xs text-slate-500"}," Scheduled jobs and assignments that are in progress or awaiting go-live. ",-1)),h.value.length?(n(),d("div",oe,[(n(!0),d(b,null,y(h.value,r=>{var f;return n(),d("article",{key:r.id,class:"rounded-2xl border border-slate-200 bg-slate-50 p-4 transition hover:-translate-y-0.5 hover:shadow"},[s("div",ae,[s("div",null,[s("h3",le,a(r.title||`Job #${r.id}`),1),s("p",ne,a(J(r)),1)]),s("span",de,a(M(r)),1)]),s("div",ie,[s("span",null,"Driver: "+a(((f=r.assigned_to)==null?void 0:f.name)||r.driver_name||"Not assigned"),1),r.goes_live_at?(n(),d("span",pe,"Goes live "+a(v(r.goes_live_at)),1)):r.pickup_at?(n(),d("span",ue,"Pickup "+a(v(r.pickup_at)),1)):P("",!0)]),s("div",ce,[i(c(x),{to:`/jobs/${r.id}`,class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50"},{default:p(()=>[...e[8]||(e[8]=[u(" View job ",-1)])]),_:1},8,["to"]),i(c(x),{to:`/jobs/${r.id}/edit`,class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold text-slate-700 hover:bg-slate-50"},{default:p(()=>[...e[9]||(e[9]=[u(" Edit run ",-1)])]),_:1},8,["to"])])])}),128))])):(n(),d("div",re," You have no scheduled runs right now. Create a job to reserve a driver. "))]),i(R)]),s("aside",xe,[e[14]||(e[14]=s("h2",{class:"text-sm font-semibold text-slate-900"},"Dealer essentials",-1)),e[15]||(e[15]=s("p",{class:"text-sm text-slate-600"}," Post runs, message drivers, and finalise paperwork faster with these shortcuts. ",-1)),s("div",me,[i(c(x),{to:"/jobs/new",class:"block rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 font-semibold text-emerald-700 transition hover:bg-emerald-100"},{default:p(()=>[...e[11]||(e[11]=[u(" Create a new job ",-1)])]),_:1}),i(c(x),{to:"/profile/completed",class:"block rounded-xl border border-slate-200 px-3 py-2 font-semibold text-slate-700 transition hover:bg-slate-50"},{default:p(()=>[...e[12]||(e[12]=[u(" View completed jobs ",-1)])]),_:1}),i(c(x),{to:"/messages",class:"block rounded-xl border border-slate-200 px-3 py-2 font-semibold text-slate-700 transition hover:bg-slate-50"},{default:p(()=>[...e[13]||(e[13]=[u(" Check messages ",-1)])]),_:1})]),e[16]||(e[16]=s("div",{class:"rounded-2xl border border-slate-200 bg-slate-50 p-3 text-xs text-slate-600"}," Tip: Need to adjust availability or reserve a lane? Save a hold in the planner first, then publish a job with the exact slot. ",-1))])]))}};export{he as default};
