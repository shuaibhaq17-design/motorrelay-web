import{u as G,c as l,a as c,k as i,b as t,t as n,n as w,F as A,j as k,e as I,h as z}from"./index-17v5VSGm.js";const O={class:"tile grid gap-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm md:grid-cols-[200px,1fr]"},$={class:"grid gap-4"},q={class:"border-b border-slate-100 pb-4"},H={class:"text-xl font-semibold text-slate-900"},K={class:"text-sm text-slate-600"},Q={class:"mt-2 text-sm font-semibold text-emerald-600"},U={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},W={class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},X={class:"mt-1 text-2xl font-bold text-slate-900"},Y={class:"rounded-2xl border border-slate-200 bg-white p-4"},Z={class:"mb-3 flex items-center justify-between"},j={key:0,class:"text-xs text-slate-500"},ee={key:0,class:"text-sm text-slate-600"},te={key:1,class:"space-y-3"},se={class:"flex items-start justify-between gap-3"},ae={class:"text-sm font-semibold text-slate-900"},re={class:"text-xs text-slate-500"},oe={class:"badge bg-slate-200 text-slate-800"},le={class:"mt-2 text-sm text-slate-700"},ne={class:"text-xs text-slate-500"},de={__name:"ProfileScorecard",setup(ce){const o=G(),g=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}),R=l(()=>{var r,s;if((r=o.user)!=null&&r.name)return o.user.name;const e=((s=o.user)==null?void 0:s.email)??"";return e.includes("@")?e.split("@")[0]:"MotorRelay driver"}),S=l(()=>{var e;return((e=o.user)==null?void 0:e.email)??"user@motorrelay.com"}),C=l(()=>o.role==="dealer"?"MotorRelay dealer":o.role==="admin"?"MotorRelay admin":"MotorRelay driver"),v=l(()=>o.role==="dealer"),P=l(()=>4.8),x=l(()=>{const e=Array.isArray(o.assignedJobs)?o.assignedJobs:[],r=Array.isArray(o.postedJobs)?o.postedJobs:[];let s=e;return o.role==="admin"?s=[...e,...r]:o.role==="dealer"&&(s=r),[...s].sort((m,a)=>{const p=new Date((m==null?void 0:m.created_at)??0).getTime();return new Date((a==null?void 0:a.created_at)??0).getTime()-p})}),J=l(()=>o.loading&&!!o.token),u=l(()=>T(x.value)),L=l(()=>g.format(u.value.totalRevenue)),B=l(()=>g.format(u.value.avgPrice)),_=l(()=>{const e=new Set(["completed","closed"]);return x.value.filter(r=>e.has(String(r.status||"").toLowerCase()))}),h=l(()=>_.value.length>0),b=l(()=>_.value.slice(0,5)),D=l(()=>b.value.length),N=l(()=>[{label:"Completed jobs",value:u.value.completed},{label:"Active jobs",value:u.value.current},{label:"On time",value:`${u.value.onTimePct}%`},{label:"Total revenue",value:L.value},{label:"Average price",value:B.value},{label:"Cancelled",value:u.value.cancelled}]);function T(e){const r=new Set(["accepted","collected","in_transit","pending","in_progress"]),s=new Set(["completed","delivered","closed"]),m="cancelled",a={completed:0,current:0,cancelled:0,totalRevenue:0,avgPrice:0,onTimePct:0},p=Array.isArray(e)?e.filter(d=>s.has(String(d.status||"").toLowerCase())):[],y=Array.isArray(e)?e.filter(d=>r.has(String(d.status||"").toLowerCase())):[],V=Array.isArray(e)?e.filter(d=>String(d.status||"").toLowerCase()===m):[];a.completed=p.length,a.current=y.length,a.cancelled=V.length,a.totalRevenue=p.reduce((d,E)=>d+Number(E.price||0),0),a.avgPrice=a.completed?a.totalRevenue/a.completed:0;const f=a.completed+a.cancelled;return a.onTimePct=f?Math.round(a.completed/f*100):0,a}function F(e){if(!e)return"--";try{return new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(e))}catch{return e}}function M(e){return g.format(Number(e||0))}return(e,r)=>(i(),c("section",O,[r[2]||(r[2]=t("div",{class:"space-y-4"},[t("div",{class:"grid h-40 w-40 place-items-center rounded-2xl border border-slate-200 bg-slate-50 text-sm text-slate-500"}," Photo "),t("p",{class:"text-xs text-slate-500"}," Placeholder photo assigned at registration. ")],-1)),t("div",$,[t("header",q,[t("h2",H,n(R.value),1),t("p",K,n(S.value)+" • "+n(C.value),1),t("p",Q," Rating: "+n(P.value.toFixed(1))+" / 5 ",1)]),J.value?(i(),c("div",U," Loading scorecard… ")):(i(),c("div",{key:1,class:w(["grid",v.value?"grid-cols-3 gap-2 sm:grid-cols-3 lg:grid-cols-3":"gap-3 sm:grid-cols-2 lg:grid-cols-3"])},[(i(!0),c(A,null,k(N.value,s=>(i(),c("article",{key:s.label,class:w(["rounded-xl border border-slate-200 bg-white",v.value?"p-3":"p-4"])},[t("h3",W,n(s.label),1),t("p",X,n(s.value),1)],2))),128))],2)),t("section",Y,[t("header",Z,[r[0]||(r[0]=t("h3",{class:"text-sm font-semibold text-slate-900"},"Recent jobs",-1)),h.value?(i(),c("span",j,"Last "+n(D.value)+" shown",1)):I("",!0)]),h.value?(i(),c("ol",te,[(i(!0),c(A,null,k(b.value,s=>(i(),c("li",{key:s.id,class:"rounded-xl border border-slate-100 bg-slate-50 p-3"},[t("div",se,[t("div",null,[t("p",ae,n(M(s.price)),1),t("p",re,n(F(s.created_at)),1)]),t("span",oe,n(s.status),1)]),t("p",le,n(s.company||"Customer")+" • "+n(s.vehicle_make||"Vehicle"),1),t("p",ne,n(s.pickup_postcode||"??")+" → "+n(s.dropoff_postcode||"??"),1)]))),128))])):(i(),c("p",ee," No job activity yet. Accepted or posted runs will appear here once work starts. "))]),r[1]||(r[1]=t("p",{class:"text-sm text-slate-500"},[z(" Recent reviews: "),t("i",null,"Reliable, careful with EVs, good comms.")],-1))])]))}};export{de as _};
