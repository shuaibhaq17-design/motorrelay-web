import{u as L,l as T,r as x,c as k,o as B,s as E,a as o,b as t,e as m,f as N,_ as O,m as Y,p as u,v as p,i as v,t as d,F as V,j as C,h as j,n as z,d as I,w as J,C as Q,k as a}from"./index-17v5VSGm.js";import{f as W,s as $}from"./account-CYXTeYHc.js";const q={class:"grid gap-6 lg:grid-cols-[2fr_1fr]"},G={class:"space-y-6"},H={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},K={class:"mb-4 flex flex-wrap items-start gap-3"},X={class:"grid gap-4 md:grid-cols-2"},Z={key:0},ee={key:1},te={key:2},se={class:"flex flex-wrap items-center gap-3"},le=["disabled"],re={key:0},oe={key:1},ae={key:0,class:"rounded-xl border border-emerald-200 bg-emerald-50 p-3 text-xs text-emerald-700"},ne={key:1,class:"rounded-xl border border-amber-200 bg-amber-50 p-3 text-xs text-amber-700"},de={key:0,class:"mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4"},ie={class:"mt-3 space-y-2"},ue={class:"text-sm font-semibold text-slate-900"},pe={class:"text-xs text-slate-500"},me={class:"flex items-center gap-3"},ce=["href"],xe={key:1,class:"text-xs text-slate-500"},be={key:1,class:"mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4"},fe={class:"mt-3 space-y-2"},ye={class:"text-sm font-semibold text-slate-900"},ve={class:"text-xs text-slate-500"},_e={class:"flex items-center gap-3"},ge=["href"],he={key:1,class:"text-xs text-slate-500"},we={class:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},ke={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Ve={key:1,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Ce={key:2,class:"space-y-3"},Ue={class:"flex flex-wrap items-center justify-between gap-3"},Se={class:"text-sm font-semibold text-slate-900"},Ae={class:"text-xs text-slate-500"},De={key:0,class:"text-xs text-slate-500"},Re={class:"mt-3 rounded-xl bg-slate-50 p-3 text-xs text-slate-600"},Me={key:0,class:"mt-2 rounded-xl bg-emerald-50 p-2 text-xs text-emerald-700"},Ne={class:"space-y-4 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"},Le={__name:"AccountSettings",setup(je){const r=L(),l=T({name:"",email:"",phone:"",company:"",address_line_one:"",address_line_two:"",city:"",postcode:"",company_number:"",passport_number:"",driver_dvla_code:"",notes:""}),b=x(!1),f=x(""),y=x(""),_=x([]),g=x(!1),i=k(()=>r.user||{}),h=x(!1);function P(){i.value&&(l.name=i.value.name||"",l.email=i.value.email||"",l.phone=i.value.phone||"",l.company=i.value.company||"",l.address_line_one=i.value.address_line_one||"",l.address_line_two=i.value.address_line_two||"",l.city=i.value.city||"",l.postcode=i.value.postcode||"",l.company_number=i.value.company_number||"",l.passport_number=i.value.passport_number||"",l.driver_dvla_code=i.value.driver_dvla_code||"",h.value||(l.notes=""),h.value=!0)}async function U(){g.value=!0;try{const n=await W();_.value=Array.isArray(n==null?void 0:n.data)?n.data:[]}catch(n){console.error("Failed to load account change requests",n)}finally{g.value=!1}}function S(n){if(!n)return"";const e=String(n).split("?")[0],c=e.split(/[\\/]/).filter(Boolean);return c.length?c[c.length-1]:e}const A=k(()=>!r.user||r.role!=="dealer"?[]:[{label:"Trade policy document",path:r.user.trade_policy_path,url:r.user.trade_policy_url},{label:"Trade plate photo",path:r.user.trade_plate_photo_path,url:r.user.trade_plate_photo_url},{label:"Utility bill",path:r.user.utility_bill_path,url:r.user.utility_bill_url},{label:"Passport selfie",path:r.user.passport_selfie_path,url:r.user.passport_selfie_url}].filter(e=>e.path||e.url).map(e=>({...e,name:S(e.path||e.url||"")}))),D=k(()=>!r.user||r.role!=="driver"?[]:[{label:"Utility bill",path:r.user.driver_utility_bill_path,url:r.user.driver_utility_bill_url},{label:"Driving licence (front)",path:r.user.driver_license_front_path,url:r.user.driver_license_front_url},{label:"Driving licence (back)",path:r.user.driver_license_back_path,url:r.user.driver_license_back_url},{label:"Passport photo",path:r.user.driver_passport_path,url:r.user.driver_passport_url},{label:"Verification selfie",path:r.user.driver_selfie_path,url:r.user.driver_selfie_url}].filter(e=>e.path||e.url).map(e=>({...e,name:S(e.path||e.url||"")})));async function F(){var n,e,c,s,R,M;b.value=!0,f.value="",y.value="";try{await $({...l}),f.value="Thanks! Your update was sent to the MotorRelay admin team.",l.notes="",await U()}catch(w){console.error("Failed to send update request",w),y.value=((e=(n=w.response)==null?void 0:n.data)==null?void 0:e.message)||((M=(R=(s=(c=w.response)==null?void 0:c.data)==null?void 0:s.errors)==null?void 0:R.request)==null?void 0:M[0])||"We could not send your update. Please review your changes and try again."}finally{b.value=!1}}return B(async()=>{!r.user&&r.token&&await r.fetchMe().catch(()=>null),await U()}),E(()=>r.user,(n,e)=>{n&&(!e||!h.value)&&P()},{immediate:!0}),(n,e)=>{const c=Q("RouterLink");return a(),o("div",q,[t("div",G,[t("section",H,[t("header",K,[N(O),e[12]||(e[12]=t("div",{class:"space-y-2"},[t("h1",{class:"text-2xl font-bold text-slate-900"},"Account settings"),t("p",{class:"text-sm text-slate-600"}," Update key account details. Changes stay pending until a MotorRelay admin approves them. ")],-1))]),t("form",{class:"space-y-4",onSubmit:Y(F,["prevent"])},[t("div",X,[t("div",null,[e[13]||(e[13]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Full name",-1)),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.name=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.name]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Email",-1)),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.email=s),type:"email",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.email]])]),t("div",null,[e[15]||(e[15]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Phone",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.phone=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.phone]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Company",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.company=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.company]])]),v(r).role==="dealer"?(a(),o("div",Z,[e[17]||(e[17]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Company number",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.company_number=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.company_number]])])):m("",!0),t("div",null,[e[18]||(e[18]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Address line 1",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.address_line_one=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.address_line_one]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Address line 2",-1)),u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.address_line_two=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.address_line_two]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"City",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.city=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.city]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Postcode",-1)),u(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.postcode=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[p,l.postcode]])]),v(r).role==="driver"?(a(),o("div",ee,[e[22]||(e[22]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"DVLA share code",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.driver_dvla_code=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200",placeholder:"A1B2C3"},null,512),[[p,l.driver_dvla_code]])])):m("",!0),v(r).role==="dealer"||v(r).role==="driver"?(a(),o("div",te,[e[23]||(e[23]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Passport number",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.passport_number=s),type:"text",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200",placeholder:"123456789"},null,512),[[p,l.passport_number]])])):m("",!0)]),t("div",null,[e[24]||(e[24]=t("label",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"},"Notes for admin",-1)),u(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.notes=s),rows:"3",class:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200",placeholder:"Add supporting context for the MotorRelay team (optional)"},null,512),[[p,l.notes]])]),t("div",se,[t("button",{type:"submit",class:"rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-60",disabled:b.value},[b.value?(a(),o("span",re,"Sending...")):(a(),o("span",oe,"Submit for review"))],8,le),e[25]||(e[25]=t("p",{class:"text-xs text-slate-500"}," Changes apply only after a MotorRelay admin approves them. Youâ€™ll be notified once actioned. ",-1))]),f.value?(a(),o("p",ae,d(f.value),1)):m("",!0),y.value?(a(),o("p",ne,d(y.value),1)):m("",!0)],32),A.value.length?(a(),o("div",de,[e[26]||(e[26]=t("h2",{class:"text-sm font-semibold text-slate-900"},"Dealer documents on file",-1)),e[27]||(e[27]=t("p",{class:"mt-1 text-xs text-slate-500"}," These documents were submitted during dealer verification. Contact support if you need to replace them. ",-1)),t("ul",ie,[(a(!0),o(V,null,C(A.value,s=>(a(),o("li",{key:s.label,class:"flex flex-wrap items-center justify-between gap-3 rounded-xl border border-slate-200 bg-white px-4 py-3"},[t("div",null,[t("p",ue,d(s.label),1),t("p",pe,d(s.name||"Document uploaded"),1)]),t("div",me,[s.url?(a(),o("a",{key:0,href:s.url,target:"_blank",rel:"noopener",class:"text-xs font-semibold text-emerald-600 hover:underline"}," View ",8,ce)):(a(),o("span",xe,d(s.path),1))])]))),128))])])):m("",!0),D.value.length?(a(),o("div",be,[e[28]||(e[28]=t("h2",{class:"text-sm font-semibold text-slate-900"},"Driver verification documents",-1)),e[29]||(e[29]=t("p",{class:"mt-1 text-xs text-slate-500"}," Identity checks stay on file once your driver account is accepted. Contact support if updates are required. ",-1)),t("ul",fe,[(a(!0),o(V,null,C(D.value,s=>(a(),o("li",{key:s.label,class:"flex flex-wrap items-center justify-between gap-3 rounded-xl border border-slate-200 bg-white px-4 py-3"},[t("div",null,[t("p",ye,d(s.label),1),t("p",ve,d(s.name||"Document uploaded"),1)]),t("div",_e,[s.url?(a(),o("a",{key:0,href:s.url,target:"_blank",rel:"noopener",class:"text-xs font-semibold text-emerald-600 hover:underline"}," View ",8,ge)):(a(),o("span",he,d(s.path),1))])]))),128))])])):m("",!0)]),t("section",we,[e[31]||(e[31]=t("header",{class:"mb-4 flex items-center justify-between gap-2"},[t("div",null,[t("h2",{class:"text-lg font-semibold text-slate-900"},"Change history"),t("p",{class:"text-xs text-slate-500"}," Track pending and recently reviewed account updates. ")])],-1)),g.value?(a(),o("div",ke," Loading account requests... ")):_.value.length?(a(),o("div",Ce,[(a(!0),o(V,null,C(_.value,s=>(a(),o("article",{key:s.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[t("div",Ue,[t("div",null,[t("p",Se," Submitted "+d(s.created_at?new Date(s.created_at).toLocaleString():"--"),1),t("p",Ae,[e[30]||(e[30]=j(" Status: ",-1)),t("span",{class:z(["font-semibold",{"text-emerald-600":s.status==="approved","text-amber-600":s.status==="pending","text-rose-600":s.status==="rejected"}])},d(s.status),3)])]),s.reviewed_at?(a(),o("p",De," Reviewed "+d(new Date(s.reviewed_at).toLocaleString()),1)):m("",!0)]),t("pre",Re,d(JSON.stringify(s.payload,null,2)),1),s.admin_notes?(a(),o("p",Me," Admin note: "+d(s.admin_notes),1)):m("",!0)]))),128))])):(a(),o("div",Ve," No account change requests yet. "))])]),t("aside",Ne,[e[33]||(e[33]=I('<h2 class="text-sm font-semibold text-slate-900">Need support?</h2><p class="text-sm text-slate-600"> Our team can help update registration details, transfer ownership, or verify documents faster if you submit accurate company information. </p><div class="space-y-2 text-xs text-slate-500"><p>Email: <a class="font-semibold text-emerald-600 hover:underline" href="mailto:support@motorrelay.com">support@motorrelay.com</a></p><p>Phone: <span class="font-semibold text-slate-700">0161 000 1122</span></p></div>',3)),N(c,{to:"/profile/completed",class:"inline-flex items-center justify-center rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm font-semibold text-emerald-700 transition hover:bg-emerald-100"},{default:J(()=>[...e[32]||(e[32]=[j(" View completed jobs ",-1)])]),_:1})])])}}};export{Le as default};
